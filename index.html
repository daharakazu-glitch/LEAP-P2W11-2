<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
  <meta http-equiv="Content-Style-Type" content="text/css">
  <title></title>
  <meta name="Generator" content="Cocoa HTML Writer">
  <meta name="CocoaVersion" content="2685.2">
  <style type="text/css">
    p.p1 {margin: 0.0px 0.0px 0.0px 0.0px; font: 14.0px Menlo; color: #6d6d6d; -webkit-text-stroke: #6d6d6d}
    p.p2 {margin: 0.0px 0.0px 0.0px 0.0px; font: 14.0px Menlo; color: #6b0001; -webkit-text-stroke: #6b0001}
    p.p3 {margin: 0.0px 0.0px 0.0px 0.0px; font: 14.0px Menlo; color: #fb0007; -webkit-text-stroke: #fb0007}
    p.p4 {margin: 0.0px 0.0px 0.0px 0.0px; font: 14.0px Menlo; color: #0000ff; -webkit-text-stroke: #0000ff}
    p.p5 {margin: 0.0px 0.0px 0.0px 0.0px; font: 14.0px Menlo; -webkit-text-stroke: #000000}
    p.p6 {margin: 0.0px 0.0px 0.0px 0.0px; font: 14.0px Menlo; color: #18702b; -webkit-text-stroke: #18702b}
    p.p7 {margin: 0.0px 0.0px 0.0px 0.0px; font: 14.0px Menlo; -webkit-text-stroke: #000000; min-height: 16.0px}
    p.p8 {margin: 0.0px 0.0px 0.0px 0.0px; font: 14.0px Menlo; color: #4d5055; -webkit-text-stroke: #4d5055}
    p.p9 {margin: 0.0px 0.0px 0.0px 0.0px; font: 14.0px Menlo; color: #093c94; -webkit-text-stroke: #093c94}
    p.p10 {margin: 0.0px 0.0px 0.0px 0.0px; font: 14.0px Menlo; color: #0e6e6d; -webkit-text-stroke: #0e6e6d}
    p.p11 {margin: 0.0px 0.0px 0.0px 0.0px; font: 14.0px Menlo; color: #570002; -webkit-text-stroke: #570002; min-height: 16.0px}
    span.s1 {font-kerning: none; background-color: #ecf1f7}
    span.s2 {font-kerning: none; color: #fb0007; background-color: #ecf1f7; -webkit-text-stroke: 0px #fb0007}
    span.s3 {font-kerning: none; color: #2a2a2a; background-color: #ecf1f7; -webkit-text-stroke: 0px #2a2a2a}
    span.s4 {font-kerning: none; color: #000000; background-color: #ecf1f7; -webkit-text-stroke: 0px #000000}
    span.s5 {font-kerning: none; color: #0000ff; background-color: #ecf1f7; -webkit-text-stroke: 0px #0000ff}
    span.s6 {font-kerning: none; color: #6b0001; background-color: #ecf1f7; -webkit-text-stroke: 0px #6b0001}
    span.s7 {font-kerning: none; color: #6f0ec3; background-color: #ecf1f7; -webkit-text-stroke: 0px #6f0ec3}
    span.s8 {font-kerning: none; color: #093c94; background-color: #ecf1f7; -webkit-text-stroke: 0px #093c94}
    span.s9 {font-kerning: none; color: #4d5055; background-color: #ecf1f7; -webkit-text-stroke: 0px #4d5055}
    span.s10 {font-kerning: none}
    span.s11 {font-kerning: none; color: #137646; background-color: #ecf1f7; -webkit-text-stroke: 0px #137646}
    span.s12 {font-kerning: none; color: #18702b; background-color: #ecf1f7; -webkit-text-stroke: 0px #18702b}
    span.s13 {font-kerning: none; color: #0e6e6d; background-color: #ecf1f7; -webkit-text-stroke: 0px #0e6e6d}
    span.s14 {font-kerning: none; color: #a4450b; background-color: #ecf1f7; -webkit-text-stroke: 0px #a4450b}
  </style>
</head>
<body>
<p class="p1"><span class="s1">&lt;!DOCTYPE</span><span class="s2"> html</span><span class="s1">&gt;</span></p>
<p class="p2"><span class="s3">&lt;</span><span class="s1">html</span><span class="s4"> </span><span class="s2">lang</span><span class="s3">=</span><span class="s5">"ja"</span><span class="s3">&gt;</span></p>
<p class="p2"><span class="s3">&lt;</span><span class="s1">head</span><span class="s3">&gt;</span></p>
<p class="p3"><span class="s3">&lt;</span><span class="s6">meta</span><span class="s4"> </span><span class="s1">charset</span><span class="s3">=</span><span class="s5">"UTF-8"</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s3">&lt;</span><span class="s6">meta</span><span class="s4"> </span><span class="s2">name</span><span class="s3">=</span><span class="s1">"viewport"</span><span class="s4"> </span><span class="s2">content</span><span class="s3">=</span><span class="s1">"width=device-width, initial-scale=1.0"</span><span class="s3">&gt;</span></p>
<p class="p5"><span class="s3">&lt;</span><span class="s6">title</span><span class="s3">&gt;</span><span class="s1">LEAP 学習アプリ (Part 2 Week 11)</span><span class="s3">&lt;/</span><span class="s6">title</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s3">&lt;</span><span class="s6">script</span><span class="s4"> </span><span class="s2">src</span><span class="s3">=</span><span class="s1">"https://cdn.tailwindcss.com"</span><span class="s3">&gt;&lt;/</span><span class="s6">script</span><span class="s3">&gt;</span></p>
<p class="p2"><span class="s3">&lt;</span><span class="s1">style</span><span class="s3">&gt;</span></p>
<p class="p6"><span class="s7">@import</span><span class="s4"> </span><span class="s8">url</span><span class="s4">(</span><span class="s1">'https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;700&amp;family=Tinos:wght@700&amp;display=swap'</span><span class="s4">);</span></p>
<p class="p2"><span class="s1">body</span><span class="s4"> {</span></p>
<p class="p3"><span class="s1">background-color:</span><span class="s4"> </span><span class="s8">#007BFF</span><span class="s4">; </span><span class="s9">/* ビビットなブルー */</span></p>
<p class="p6"><span class="s2">font-family:</span><span class="s4"> </span><span class="s1">'Noto Sans JP'</span><span class="s4">, </span><span class="s8">sans-serif</span><span class="s4">;</span></p>
<p class="p5"><span class="s1">}</span></p>
<p class="p7"><span class="s10"></span><br></p>
<p class="p8"><span class="s1">/* 英語フォントをTimes New Romanに設定 */</span></p>
<p class="p2"><span class="s1">.font-english</span><span class="s4"> {</span></p>
<p class="p6"><span class="s2">font-family:</span><span class="s4"> </span><span class="s1">'Tinos'</span><span class="s4">, </span><span class="s1">'Times New Roman'</span><span class="s4">, </span><span class="s8">serif</span><span class="s4">;</span></p>
<p class="p3"><span class="s1">font-weight:</span><span class="s4"> </span><span class="s11">700</span><span class="s4">;</span></p>
<p class="p3"><span class="s1">font-size:</span><span class="s4"> </span><span class="s11">1.25rem</span><span class="s4">; </span><span class="s9">/* 20px */</span></p>
<p class="p3"><span class="s1">line-height:</span><span class="s4"> </span><span class="s11">1.75rem</span><span class="s4">; </span><span class="s9">/* 28px */</span></p>
<p class="p5"><span class="s1">}</span></p>
<p class="p7"><span class="s10"></span><br></p>
<p class="p2"><span class="s1">.answer-span</span><span class="s4"> {</span></p>
<p class="p8"><span class="s2">color:</span><span class="s4"> </span><span class="s8">#DC2626</span><span class="s4">; </span><span class="s1">/* 赤色 */</span></p>
<p class="p3"><span class="s1">font-weight:</span><span class="s4"> </span><span class="s11">700</span><span class="s4">;</span></p>
<p class="p3"><span class="s1">display:</span><span class="s4"> </span><span class="s8">none</span><span class="s4">;</span></p>
<p class="p5"><span class="s1">}</span></p>
<p class="p7"><span class="s10"></span><br></p>
<p class="p2"><span class="s1">.underline-span</span><span class="s4"> {</span></p>
<p class="p3"><span class="s1">text-decoration:</span><span class="s4"> </span><span class="s8">underline</span><span class="s4">;</span></p>
<p class="p3"><span class="s1">text-underline-offset:</span><span class="s4"> </span><span class="s11">4px</span><span class="s4">;</span></p>
<p class="p3"><span class="s1">display:</span><span class="s4"> </span><span class="s8">inline</span><span class="s4">;</span></p>
<p class="p5"><span class="s1">}</span></p>
<p class="p7"><span class="s10"></span><br></p>
<p class="p2"><span class="s1">.show-answer</span><span class="s4"> </span><span class="s1">.answer-span</span><span class="s4"> {</span></p>
<p class="p3"><span class="s1">display:</span><span class="s4"> </span><span class="s8">inline</span><span class="s4">;</span></p>
<p class="p5"><span class="s1">}</span></p>
<p class="p7"><span class="s10"></span><br></p>
<p class="p2"><span class="s1">.show-answer</span><span class="s4"> </span><span class="s1">.underline-span</span><span class="s4"> {</span></p>
<p class="p3"><span class="s1">display:</span><span class="s4"> </span><span class="s8">none</span><span class="s4">;</span></p>
<p class="p5"><span class="s1">}</span></p>
<p class="p2"><span class="s1">.explanation</span><span class="s4"> {</span></p>
<p class="p3"><span class="s1">display:</span><span class="s4"> </span><span class="s8">none</span><span class="s4">;</span></p>
<p class="p3"><span class="s1">white-space:</span><span class="s4"> </span><span class="s8">pre-wrap</span><span class="s4">;</span></p>
<p class="p5"><span class="s1">}</span></p>
<p class="p7"><span class="s10"></span><br></p>
<p class="p2"><span class="s1">.btn</span><span class="s4"> {</span></p>
<p class="p9"><span class="s4"><span class="Apple-converted-space">    </span></span><span class="s2">display:</span><span class="s4"> </span><span class="s1">inline-flex</span><span class="s4">;</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">    </span></span><span class="s1">align-items:</span><span class="s4"> </span><span class="s8">center</span><span class="s4">;</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">    </span></span><span class="s1">justify-content:</span><span class="s4"> </span><span class="s8">center</span><span class="s4">;</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">    </span></span><span class="s1">padding:</span><span class="s4"> </span><span class="s11">10px</span><span class="s4"> </span><span class="s11">20px</span><span class="s4">;</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">    </span></span><span class="s1">border-radius:</span><span class="s4"> </span><span class="s11">8px</span><span class="s4">;</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">    </span></span><span class="s1">font-weight:</span><span class="s4"> </span><span class="s8">bold</span><span class="s4">;</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">    </span></span><span class="s1">cursor:</span><span class="s4"> </span><span class="s8">pointer</span><span class="s4">;</span></p>
<p class="p9"><span class="s4"><span class="Apple-converted-space">    </span></span><span class="s2">transition:</span><span class="s4"> </span><span class="s1">all</span><span class="s4"> </span><span class="s11">0.2s</span><span class="s4"> </span><span class="s1">ease-in-out</span><span class="s4">;</span></p>
<p class="p5"><span class="s1">}</span></p>
<p class="p2"><span class="s1">.btn-primary</span><span class="s4"> {</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">    </span></span><span class="s1">background-color:</span><span class="s4"> </span><span class="s8">#3b82f6</span><span class="s4">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">    </span></span><span class="s2">color:</span><span class="s1"> </span><span class="s8">white</span><span class="s1">;</span></p>
<p class="p5"><span class="s1">}</span></p>
<p class="p2"><span class="s1">.btn-primary:hover</span><span class="s4"> {</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">    </span></span><span class="s1">background-color:</span><span class="s4"> </span><span class="s8">#2563eb</span><span class="s4">;</span></p>
<p class="p5"><span class="s1">}</span></p>
<p class="p2"><span class="s1">.btn-secondary</span><span class="s4"> {</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">    </span></span><span class="s1">background-color:</span><span class="s4"> </span><span class="s8">#6b7280</span><span class="s4">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">    </span></span><span class="s2">color:</span><span class="s1"> </span><span class="s8">white</span><span class="s1">;</span></p>
<p class="p5"><span class="s1">}</span></p>
<p class="p2"><span class="s1">.btn-secondary:hover</span><span class="s4"> {</span></p>
<p class="p3"><span class="s4"><span class="Apple-converted-space">    </span></span><span class="s1">background-color:</span><span class="s4"> </span><span class="s8">#4b5563</span><span class="s4">;</span></p>
<p class="p5"><span class="s1">}</span></p>
<p class="p7"><span class="s10"></span><br></p>
<p class="p2"><span class="s3">&lt;/</span><span class="s1">style</span><span class="s3">&gt;</span></p>
<p class="p2"><span class="s3">&lt;/</span><span class="s1">head</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s3">&lt;</span><span class="s6">body</span><span class="s4"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"text-gray-800"</span><span class="s3">&gt;</span></p>
<p class="p7"><span class="s10"></span><br></p>
<p class="p4"><span class="s3">&lt;</span><span class="s6">div</span><span class="s4"> </span><span class="s2">id</span><span class="s3">=</span><span class="s1">"app-container"</span><span class="s4"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"container mx-auto p-4 md:p-8 max-w-4xl"</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s3">&lt;</span><span class="s6">header</span><span class="s4"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"text-center mb-8 bg-blue-500 p-4 rounded-xl shadow-lg"</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s3">&lt;</span><span class="s6">h1</span><span class="s4"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"text-2xl md:text-3xl font-bold text-white"</span><span class="s3">&gt;</span><span class="s4">LEAP 学習アプリ</span><span class="s3">&lt;/</span><span class="s6">h1</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s3">&lt;</span><span class="s6">h2</span><span class="s4"> </span><span class="s2">id</span><span class="s3">=</span><span class="s1">"app-subtitle"</span><span class="s4"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"text-xl md:text-2xl font-bold text-white"</span><span class="s3">&gt;</span><span class="s4">Part 2 Week 11（No.843-881）</span><span class="s3">&lt;/</span><span class="s6">h2</span><span class="s3">&gt;</span></p>
<p class="p2"><span class="s3">&lt;/</span><span class="s1">header</span><span class="s3">&gt;</span></p>
<p class="p7"><span class="s10"></span><br></p>
<p class="p4"><span class="s3">&lt;</span><span class="s6">main</span><span class="s4"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"bg-white/90 backdrop-blur-sm p-6 rounded-xl shadow-lg mb-28"</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s3">&lt;</span><span class="s6">div</span><span class="s4"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"flex justify-end mb-6"</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s4"><span class="Apple-converted-space">    </span></span><span class="s3">&lt;</span><span class="s6">button</span><span class="s4"> </span><span class="s2">id</span><span class="s3">=</span><span class="s1">"start-quiz-btn"</span><span class="s4"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"bg-purple-500 hover:bg-purple-600 text-white font-bold py-2 px-4 rounded-lg shadow transition-transform transform hover:scale-105"</span><span class="s3">&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">    </span>ランダムテスト</span></p>
<p class="p2"><span class="s4"><span class="Apple-converted-space">    </span></span><span class="s3">&lt;/</span><span class="s1">button</span><span class="s3">&gt;</span></p>
<p class="p2"><span class="s3">&lt;/</span><span class="s1">div</span><span class="s3">&gt;</span></p>
<p class="p7"><span class="s10"></span><br></p>
<p class="p4"><span class="s3">&lt;</span><span class="s6">div</span><span class="s4"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"mb-6 p-4 bg-gray-50 rounded-lg border border-gray-200"</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s4"><span class="Apple-converted-space">    </span></span><span class="s3">&lt;</span><span class="s6">h3</span><span class="s4"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"font-bold text-lg mb-2"</span><span class="s3">&gt;</span><span class="s4">選択した問題でPDFを作成</span><span class="s3">&lt;/</span><span class="s6">h3</span><span class="s3">&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">    </span></span><span class="s3">&lt;</span><span class="s6">p</span><span class="s1"> </span><span class="s2">class</span><span class="s3">=</span><span class="s5">"text-gray-600 mb-4"</span><span class="s3">&gt;</span><span class="s1">学習したい問題のチェックボックスを選択してから、下のボタンを押してください。</span><span class="s3">&lt;/</span><span class="s6">p</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s4"><span class="Apple-converted-space">    </span></span><span class="s3">&lt;</span><span class="s6">div</span><span class="s4"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"flex items-center mb-4"</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s4"><span class="Apple-converted-space">        </span></span><span class="s3">&lt;</span><span class="s6">input</span><span class="s4"> </span><span class="s2">type</span><span class="s3">=</span><span class="s1">"checkbox"</span><span class="s4"> </span><span class="s2">id</span><span class="s3">=</span><span class="s1">"select-all-checkbox"</span><span class="s4"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"h-4 w-4 rounded border-gray-300 text-indigo-600 focus:ring-indigo-500"</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s4"><span class="Apple-converted-space">        </span></span><span class="s3">&lt;</span><span class="s6">label</span><span class="s4"> </span><span class="s2">for</span><span class="s3">=</span><span class="s1">"select-all-checkbox"</span><span class="s4"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"ml-2 block text-sm text-gray-900"</span><span class="s3">&gt;</span><span class="s4">すべて選択 / 解除</span><span class="s3">&lt;/</span><span class="s6">label</span><span class="s3">&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">    </span></span><span class="s3">&lt;/</span><span class="s6">div</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s4"><span class="Apple-converted-space">    </span></span><span class="s3">&lt;</span><span class="s6">div</span><span class="s4"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"flex justify-center"</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s4"><span class="Apple-converted-space">        </span></span><span class="s3">&lt;</span><span class="s6">button</span><span class="s4"> </span><span class="s2">id</span><span class="s3">=</span><span class="s1">"open-pdf-modal-btn"</span><span class="s4"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"w-full sm:w-auto bg-green-500 hover:bg-green-600 text-white font-bold py-2 px-4 rounded-lg shadow transition-transform transform hover:scale-105"</span><span class="s3">&gt;</span><span class="s4">PDFダウンロードの種類を選択</span><span class="s3">&lt;/</span><span class="s6">button</span><span class="s3">&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">    </span></span><span class="s3">&lt;/</span><span class="s6">div</span><span class="s3">&gt;</span></p>
<p class="p2"><span class="s3">&lt;/</span><span class="s1">div</span><span class="s3">&gt;</span></p>
<p class="p7"><span class="s10"></span><br></p>
<p class="p7"><span class="s10"></span><br></p>
<p class="p4"><span class="s3">&lt;</span><span class="s6">div</span><span class="s4"> </span><span class="s2">id</span><span class="s3">=</span><span class="s1">"sentence-list"</span><span class="s4"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"space-y-6"</span><span class="s3">&gt;</span></p>
<p class="p8"><span class="s1">&lt;!-- Sentences will be populated by JS --&gt;</span></p>
<p class="p2"><span class="s3">&lt;/</span><span class="s1">div</span><span class="s3">&gt;</span></p>
<p class="p2"><span class="s3">&lt;/</span><span class="s1">main</span><span class="s3">&gt;</span></p>
<p class="p2"><span class="s3">&lt;/</span><span class="s1">div</span><span class="s3">&gt;</span></p>
<p class="p7"><span class="s10"></span><br></p>
<p class="p8"><span class="s1">&lt;!-- Control Panel --&gt;</span></p>
<p class="p4"><span class="s3">&lt;</span><span class="s6">div</span><span class="s4"> </span><span class="s2">id</span><span class="s3">=</span><span class="s1">"control-panel"</span><span class="s4"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"fixed bottom-0 left-0 right-0 bg-white/80 backdrop-blur-md p-4 border-t-2 border-gray-200 shadow-2xl flex justify-center items-center space-x-2 md:space-x-4"</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s3">&lt;</span><span class="s6">button</span><span class="s4"> </span><span class="s2">id</span><span class="s3">=</span><span class="s1">"toggle-answer-btn"</span><span class="s4"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-4 rounded-lg shadow-md transition-transform transform hover:scale-105"</span><span class="s3">&gt;</span><span class="s4">表示/非表示</span><span class="s3">&lt;/</span><span class="s6">button</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s3">&lt;</span><span class="s6">button</span><span class="s4"> </span><span class="s2">id</span><span class="s3">=</span><span class="s1">"play-sound-btn"</span><span class="s4"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"bg-green-500 hover:bg-green-600 text-white font-bold py-2 px-4 rounded-lg shadow-md transition-transform transform hover:scale-105"</span><span class="s3">&gt;</span><span class="s4">音声再生</span><span class="s3">&lt;/</span><span class="s6">button</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s3">&lt;</span><span class="s6">button</span><span class="s4"> </span><span class="s2">id</span><span class="s3">=</span><span class="s1">"record-btn"</span><span class="s4"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"bg-red-500 hover:bg-red-600 text-white font-bold py-2 px-4 rounded-lg shadow-md transition-transform transform hover:scale-105"</span><span class="s3">&gt;</span><span class="s4">録音評価</span><span class="s3">&lt;/</span><span class="s6">button</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s3">&lt;</span><span class="s6">button</span><span class="s4"> </span><span class="s2">id</span><span class="s3">=</span><span class="s1">"toggle-explanation-btn"</span><span class="s4"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"bg-yellow-500 hover:bg-yellow-600 text-white font-bold py-2 px-4 rounded-lg shadow-md transition-transform transform hover:scale-105"</span><span class="s3">&gt;</span><span class="s4">語の意味</span><span class="s3">&lt;/</span><span class="s6">button</span><span class="s3">&gt;</span></p>
<p class="p2"><span class="s3">&lt;/</span><span class="s1">div</span><span class="s3">&gt;</span></p>
<p class="p7"><span class="s10"></span><br></p>
<p class="p8"><span class="s1">&lt;!-- Message/Score Modal --&gt;</span></p>
<p class="p4"><span class="s3">&lt;</span><span class="s6">div</span><span class="s4"> </span><span class="s2">id</span><span class="s3">=</span><span class="s1">"message-modal"</span><span class="s4"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"hidden fixed inset-0 bg-black bg-opacity-50 flex justify-center items-center z-50"</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s3">&lt;</span><span class="s6">div</span><span class="s4"> </span><span class="s2">id</span><span class="s3">=</span><span class="s1">"message-content"</span><span class="s4"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"bg-white p-8 rounded-lg shadow-xl text-center"</span><span class="s3">&gt;</span></p>
<p class="p8"><span class="s1">&lt;!-- Message content will be populated by JS --&gt;</span></p>
<p class="p2"><span class="s3">&lt;/</span><span class="s1">div</span><span class="s3">&gt;</span></p>
<p class="p2"><span class="s3">&lt;/</span><span class="s1">div</span><span class="s3">&gt;</span></p>
<p class="p8"><span class="s1">&lt;!-- Quiz Modal --&gt;</span></p>
<p class="p4"><span class="s3">&lt;</span><span class="s6">div</span><span class="s4"> </span><span class="s2">id</span><span class="s3">=</span><span class="s1">"quiz-modal"</span><span class="s4"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"hidden fixed inset-0 bg-black bg-opacity-60 flex justify-center items-center z-40 p-4"</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s3">&lt;</span><span class="s6">div</span><span class="s4"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"bg-white w-full max-w-2xl p-8 rounded-2xl shadow-2xl relative"</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s3">&lt;</span><span class="s6">button</span><span class="s4"> </span><span class="s2">id</span><span class="s3">=</span><span class="s1">"close-quiz-btn"</span><span class="s4"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"absolute top-4 right-4 text-gray-500 hover:text-gray-800 text-3xl font-bold"</span><span class="s3">&gt;</span><span class="s4">&amp;times;</span><span class="s3">&lt;/</span><span class="s6">button</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s3">&lt;</span><span class="s6">div</span><span class="s4"> </span><span class="s2">id</span><span class="s3">=</span><span class="s1">"quiz-content"</span><span class="s3">&gt;</span></p>
<p class="p8"><span class="s1">&lt;!-- Quiz content will be populated by JS --&gt;</span></p>
<p class="p2"><span class="s3">&lt;/</span><span class="s1">div</span><span class="s3">&gt;</span></p>
<p class="p2"><span class="s3">&lt;/</span><span class="s1">div</span><span class="s3">&gt;</span></p>
<p class="p2"><span class="s3">&lt;/</span><span class="s1">div</span><span class="s3">&gt;</span></p>
<p class="p7"><span class="s10"></span><br></p>
<p class="p8"><span class="s1">&lt;!-- PDF Download Modal --&gt;</span></p>
<p class="p4"><span class="s3">&lt;</span><span class="s6">div</span><span class="s4"> </span><span class="s2">id</span><span class="s3">=</span><span class="s1">"pdf-modal"</span><span class="s4"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"hidden fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full flex items-center justify-center z-50"</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s4"><span class="Apple-converted-space">    </span></span><span class="s3">&lt;</span><span class="s6">div</span><span class="s4"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"relative mx-auto p-5 border w-11/12 md:w-1/2 lg:w-1/3 shadow-lg rounded-md bg-white"</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s4"><span class="Apple-converted-space">        </span></span><span class="s3">&lt;</span><span class="s6">div</span><span class="s4"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"mt-3 text-center"</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s4"><span class="Apple-converted-space">            </span></span><span class="s3">&lt;</span><span class="s6">h3</span><span class="s4"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"text-lg leading-6 font-medium text-gray-900"</span><span class="s3">&gt;</span><span class="s4">ダウンロードするPDFの種類を選択</span><span class="s3">&lt;/</span><span class="s6">h3</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s4"><span class="Apple-converted-space">            </span></span><span class="s3">&lt;</span><span class="s6">div</span><span class="s4"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"mt-4 px-7 py-3 space-y-3"</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s4"><span class="Apple-converted-space">                </span></span><span class="s3">&lt;</span><span class="s6">button</span><span class="s4"> </span><span class="s2">id</span><span class="s3">=</span><span class="s1">"download-list-btn"</span><span class="s4"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"btn btn-primary w-full justify-start"</span><span class="s3">&gt;</span><span class="s4">1. 完全な単語のリスト</span><span class="s3">&lt;/</span><span class="s6">button</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s4"><span class="Apple-converted-space">                </span></span><span class="s3">&lt;</span><span class="s6">button</span><span class="s4"> </span><span class="s2">id</span><span class="s3">=</span><span class="s1">"download-en-quiz-btn"</span><span class="s4"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"btn btn-primary w-full justify-start"</span><span class="s3">&gt;</span><span class="s4">2. 英語の単語を解答する問題</span><span class="s3">&lt;/</span><span class="s6">button</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s4"><span class="Apple-converted-space">                </span></span><span class="s3">&lt;</span><span class="s6">button</span><span class="s4"> </span><span class="s2">id</span><span class="s3">=</span><span class="s1">"download-ja-quiz-btn"</span><span class="s4"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"btn btn-primary w-full justify-start"</span><span class="s3">&gt;</span><span class="s4">3. 単語の日本語訳を解答する問題</span><span class="s3">&lt;/</span><span class="s6">button</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s4"><span class="Apple-converted-space">                </span></span><span class="s3">&lt;</span><span class="s6">button</span><span class="s4"> </span><span class="s2">id</span><span class="s3">=</span><span class="s1">"download-mixed-quiz-btn"</span><span class="s4"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"btn btn-primary w-full justify-start"</span><span class="s3">&gt;</span><span class="s4">4. 英語と日本語が混在した問題</span><span class="s3">&lt;/</span><span class="s6">button</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s4"><span class="Apple-converted-space">                </span></span><span class="s3">&lt;</span><span class="s6">button</span><span class="s4"> </span><span class="s2">id</span><span class="s3">=</span><span class="s1">"download-sentence-quiz-btn"</span><span class="s4"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"btn btn-primary w-full justify-start"</span><span class="s3">&gt;</span><span class="s4">5. 例文の穴埋め問題</span><span class="s3">&lt;/</span><span class="s6">button</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s4"><span class="Apple-converted-space">                </span></span><span class="s3">&lt;</span><span class="s6">button</span><span class="s4"> </span><span class="s2">id</span><span class="s3">=</span><span class="s1">"download-sentence-mixed-quiz-btn"</span><span class="s4"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"btn btn-primary w-full justify-start"</span><span class="s3">&gt;</span><span class="s4">6. 例文の混合問題 (穴埋め/和訳)</span><span class="s3">&lt;/</span><span class="s6">button</span><span class="s3">&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s3">&lt;/</span><span class="s6">div</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s4"><span class="Apple-converted-space">            </span></span><span class="s3">&lt;</span><span class="s6">div</span><span class="s4"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"items-center px-4 py-3"</span><span class="s3">&gt;</span></p>
<p class="p4"><span class="s4"><span class="Apple-converted-space">                </span></span><span class="s3">&lt;</span><span class="s6">button</span><span class="s4"> </span><span class="s2">id</span><span class="s3">=</span><span class="s1">"close-modal-btn"</span><span class="s4"> </span><span class="s2">class</span><span class="s3">=</span><span class="s1">"btn btn-secondary w-full"</span><span class="s3">&gt;</span><span class="s4">キャンセル</span><span class="s3">&lt;/</span><span class="s6">button</span><span class="s3">&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s3">&lt;/</span><span class="s6">div</span><span class="s3">&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s3">&lt;/</span><span class="s6">div</span><span class="s3">&gt;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">    </span></span><span class="s3">&lt;/</span><span class="s6">div</span><span class="s3">&gt;</span></p>
<p class="p2"><span class="s3">&lt;/</span><span class="s1">div</span><span class="s3">&gt;</span></p>
<p class="p7"><span class="s10"></span><br></p>
<p class="p2"><span class="s3">&lt;</span><span class="s1">script</span><span class="s3">&gt;</span></p>
<p class="p8"><span class="s1">// --- App State ---</span></p>
<p class="p8"><span class="s1">// 提供されたデータに基づく新しいリスト (Part 2 Week 11, No.843-881)</span></p>
<p class="p5"><span class="s7">const</span><span class="s1"> chapterData = [</span></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">    </span>{ id: </span><span class="s1">"843"</span><span class="s4">, answer: </span><span class="s1">"somewhat"</span><span class="s4">, explanation: </span><span class="s1">"[副] いくぶん，多少"</span><span class="s4">, en: </span><span class="s1">"somewhat different"</span><span class="s4">, ja: </span><span class="s1">"いくぶん違う"</span><span class="s4"> },</span></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">    </span>{ id: </span><span class="s1">"844"</span><span class="s4">, answer: </span><span class="s1">"somehow"</span><span class="s4">, explanation: </span><span class="s1">"[副] どうにかして，どういうわけか"</span><span class="s4">, en: </span><span class="s1">"somehow finish the work"</span><span class="s4">, ja: </span><span class="s1">"どうにかして仕事を終える"</span><span class="s4"> },</span></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">    </span>{ id: </span><span class="s1">"845"</span><span class="s4">, answer: </span><span class="s1">"otherwise"</span><span class="s4">, explanation: </span><span class="s1">"[副] ①さもなければ　②その他の点では"</span><span class="s4">, en: </span><span class="s1">"Hurry up, otherwise you’ll be late."</span><span class="s4">, ja: </span><span class="s1">"急ぎなさい，さもないと遅れるよ．"</span><span class="s4"> },</span></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">    </span>{ id: </span><span class="s1">"846"</span><span class="s4">, answer: </span><span class="s1">"nevertheless"</span><span class="s4">, explanation: </span><span class="s1">"[副] それにもかかわらず"</span><span class="s4">, en: </span><span class="s1">"He is rich; nevertheless he is unhappy."</span><span class="s4">, ja: </span><span class="s1">"彼は金持ちだ，それにもかかわらず不幸だ．"</span><span class="s4"> },</span></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">    </span>{ id: </span><span class="s1">"847"</span><span class="s4">, answer: </span><span class="s1">"nonetheless"</span><span class="s4">, explanation: </span><span class="s1">"[副] それにもかかわらず"</span><span class="s4">, en: </span><span class="s1">"The book is long but nonetheless interesting."</span><span class="s4">, ja: </span><span class="s1">"その本は長いが，それでも（それにもかかわらず）面白い．"</span><span class="s4"> },</span></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">    </span>{ id: </span><span class="s1">"848"</span><span class="s4">, answer: </span><span class="s1">"furthermore"</span><span class="s4">, explanation: </span><span class="s1">"[副] その上，さらに"</span><span class="s4">, en: </span><span class="s1">"It is cheap, and furthermore it is light."</span><span class="s4">, ja: </span><span class="s1">"それは安いし，その上軽い．"</span><span class="s4"> },</span></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">    </span>{ id: </span><span class="s1">"849"</span><span class="s4">, answer: </span><span class="s1">"moreover"</span><span class="s4">, explanation: </span><span class="s1">"[副] その上，さらに"</span><span class="s4">, en: </span><span class="s1">"He is young, and moreover he is handsome."</span><span class="s4">, ja: </span><span class="s1">"彼は若いし，その上ハンサムだ．"</span><span class="s4"> },</span></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">    </span>{ id: </span><span class="s1">"850"</span><span class="s4">, answer: </span><span class="s1">"thus"</span><span class="s4">, explanation: </span><span class="s1">"[副] したがって，このように"</span><span class="s4">, en: </span><span class="s1">"Thus, he succeeded."</span><span class="s4">, ja: </span><span class="s1">"したがって，彼は成功した．"</span><span class="s4"> },</span></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">    </span>{ id: </span><span class="s1">"851"</span><span class="s4">, answer: </span><span class="s1">"therefore"</span><span class="s4">, explanation: </span><span class="s1">"[副] それゆえに，したがって"</span><span class="s4">, en: </span><span class="s1">"I think, therefore I am."</span><span class="s4">, ja: </span><span class="s1">"我思う，ゆえに我あり．"</span><span class="s4"> },</span></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">    </span>{ id: </span><span class="s1">"852"</span><span class="s4">, answer: </span><span class="s1">"despite"</span><span class="s4">, explanation: </span><span class="s1">"[前] ～にもかかわらず"</span><span class="s4">, en: </span><span class="s1">"despite the bad weather"</span><span class="s4">, ja: </span><span class="s1">"悪天候にもかかわらず"</span><span class="s4"> },</span></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">    </span>{ id: </span><span class="s1">"853"</span><span class="s4">, answer: </span><span class="s1">"unlike"</span><span class="s4">, explanation: </span><span class="s1">"[前] ～と違って"</span><span class="s4">, en: </span><span class="s1">"Unlike me, he is tall."</span><span class="s4">, ja: </span><span class="s1">"私と違って彼は背が高い．"</span><span class="s4"> },</span></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">    </span>{ id: </span><span class="s1">"854"</span><span class="s4">, answer: </span><span class="s1">"instead"</span><span class="s4">, explanation: </span><span class="s1">"[副] その代わりに"</span><span class="s4">, en: </span><span class="s1">"I’ll go there instead."</span><span class="s4">, ja: </span><span class="s1">"その代わりに私がそこへ行きます．"</span><span class="s4"> },</span></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">    </span>{ id: </span><span class="s1">"855"</span><span class="s4">, answer: </span><span class="s1">"provided"</span><span class="s4">, explanation: </span><span class="s1">"[接] （that S V）もし～ならば"</span><span class="s4">, en: </span><span class="s1">"provided (that) you agree"</span><span class="s4">, ja: </span><span class="s1">"もしあなたが同意するならば"</span><span class="s4"> },</span></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">    </span>{ id: </span><span class="s1">"856"</span><span class="s4">, answer: </span><span class="s1">"unless"</span><span class="s4">, explanation: </span><span class="s1">"[接] ～でない限り，もし～なければ"</span><span class="s4">, en: </span><span class="s1">"unless it rains"</span><span class="s4">, ja: </span><span class="s1">"雨が降らない限り"</span><span class="s4"> },</span></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">    </span>{ id: </span><span class="s1">"857"</span><span class="s4">, answer: </span><span class="s1">"whether"</span><span class="s4">, explanation: </span><span class="s1">"[接] （～ or ...）～か…か"</span><span class="s4">, en: </span><span class="s1">"whether you like it or not"</span><span class="s4">, ja: </span><span class="s1">"あなたがそれを好きかどうかにかかわらず"</span><span class="s4"> },</span></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">    </span>{ id: </span><span class="s1">"858"</span><span class="s4">, answer: </span><span class="s1">"nor"</span><span class="s4">, explanation: </span><span class="s1">"[接] （neither A nor B）AでもBでもない"</span><span class="s4">, en: </span><span class="s1">"Neither Tom nor I know him."</span><span class="s4">, ja: </span><span class="s1">"トムも私も彼を知らない．"</span><span class="s4"> },</span></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">    </span>{ id: </span><span class="s1">"859"</span><span class="s4">, answer: </span><span class="s1">"whatever"</span><span class="s4">, explanation: </span><span class="s1">"[代] ①～するもの（こと）は何でも　②どんなもの（こと）が～しようとも"</span><span class="s4">, en: </span><span class="s1">"Do whatever you like."</span><span class="s4">, ja: </span><span class="s1">"好きなことは何でもしなさい．"</span><span class="s4"> },</span></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">    </span>{ id: </span><span class="s1">"860"</span><span class="s4">, answer: </span><span class="s1">"whichever"</span><span class="s4">, explanation: </span><span class="s1">"[代] ①～するどちらでも　②どちらが～しようとも"</span><span class="s4">, en: </span><span class="s1">"Take whichever you like."</span><span class="s4">, ja: </span><span class="s1">"好きな方をどちらでも取りなさい．"</span><span class="s4"> },</span></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">    </span>{ id: </span><span class="s1">"861"</span><span class="s4">, answer: </span><span class="s1">"wherever"</span><span class="s4">, explanation: </span><span class="s1">"[接] ～するところならどこでも"</span><span class="s4">, en: </span><span class="s1">"Sit wherever you like."</span><span class="s4">, ja: </span><span class="s1">"好きなところならどこでも座りなさい．"</span><span class="s4"> },</span></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">    </span>{ id: </span><span class="s1">"862"</span><span class="s4">, answer: </span><span class="s1">"whoever"</span><span class="s4">, explanation: </span><span class="s1">"[代] ①～する人は誰でも　②誰が～しようとも"</span><span class="s4">, en: </span><span class="s1">"Whoever comes is welcome."</span><span class="s4">, ja: </span><span class="s1">"来る人は誰でも歓迎します．"</span><span class="s4"> },</span></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">    </span>{ id: </span><span class="s1">"863"</span><span class="s4">, answer: </span><span class="s1">"cause"</span><span class="s4">, explanation: </span><span class="s1">"[名] ①原因　[他] ②～を引き起こす"</span><span class="s4">, en: </span><span class="s1">"the cause of the fire"</span><span class="s4">, ja: </span><span class="s1">"火事の原因"</span><span class="s4"> },</span></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">    </span>{ id: </span><span class="s1">"864"</span><span class="s4">, answer: </span><span class="s1">"effect"</span><span class="s4">, explanation: </span><span class="s1">"[名] ①効果，影響　②結果"</span><span class="s4">, en: </span><span class="s1">"cause and effect"</span><span class="s4">, ja: </span><span class="s1">"原因と結果"</span><span class="s4"> },</span></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">    </span>{ id: </span><span class="s1">"865"</span><span class="s4">, answer: </span><span class="s1">"result"</span><span class="s4">, explanation: </span><span class="s1">"[名] ①結果　[自] ②（from ～）（～から）生じる，（in ～）（～という）結果になる"</span><span class="s4">, en: </span><span class="s1">"as a result of the war"</span><span class="s4">, ja: </span><span class="s1">"戦争の結果として"</span><span class="s4"> },</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">    </span>{ id: </span><span class="s12">"866"</span><span class="s1">, answer: </span><span class="s12">"reason"</span><span class="s1">, explanation: </span><span class="s12">"[名] 理由，理性"</span><span class="s1">, en: </span><span class="s12">"for some reason"</span><span class="s1">, ja: </span><span class="s12">"何らかの理由で"</span><span class="s1"> },</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">    </span>{ id: </span><span class="s12">"867"</span><span class="s1">, answer: </span><span class="s12">"purpose"</span><span class="s1">, explanation: </span><span class="s12">"[名] 目的"</span><span class="s1">, en: </span><span class="s12">"on purpose"</span><span class="s1">, ja: </span><span class="s12">"わざと（目的を持って）"</span><span class="s1"> },</span></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">    </span>{ id: </span><span class="s1">"868"</span><span class="s4">, answer: </span><span class="s1">"sense"</span><span class="s4">, explanation: </span><span class="s1">"[名] ①感覚　②意味"</span><span class="s4">, en: </span><span class="s1">"make sense"</span><span class="s4">, ja: </span><span class="s1">"理にかなう（意味をなす）"</span><span class="s4"> },</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">    </span>{ id: </span><span class="s12">"869"</span><span class="s1">, answer: </span><span class="s12">"way"</span><span class="s1">, explanation: </span><span class="s12">"[名] ①道　②方法"</span><span class="s1">, en: </span><span class="s12">"in a way"</span><span class="s1">, ja: </span><span class="s12">"ある意味では"</span><span class="s1"> },</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">    </span>{ id: </span><span class="s12">"870"</span><span class="s1">, answer: </span><span class="s12">"kind"</span><span class="s1">, explanation: </span><span class="s12">"[名] 種類"</span><span class="s1">, en: </span><span class="s12">"a kind of flower"</span><span class="s1">, ja: </span><span class="s12">"一種の花"</span><span class="s1"> },</span></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">    </span>{ id: </span><span class="s1">"871"</span><span class="s4">, answer: </span><span class="s1">"during"</span><span class="s4">, explanation: </span><span class="s1">"[前] ～の間"</span><span class="s4">, en: </span><span class="s1">"during the summer vacation"</span><span class="s4">, ja: </span><span class="s1">"夏休みの間"</span><span class="s4"> },</span></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">    </span>{ id: </span><span class="s1">"872"</span><span class="s4">, answer: </span><span class="s1">"until"</span><span class="s4">, explanation: </span><span class="s1">"[前] [接] ～まで（ずっと）"</span><span class="s4">, en: </span><span class="s1">"until five o'clock"</span><span class="s4">, ja: </span><span class="s1">"5時まで（ずっと）"</span><span class="s4"> },</span></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">    </span>{ id: </span><span class="s1">"873"</span><span class="s4">, answer: </span><span class="s1">"till"</span><span class="s4">, explanation: </span><span class="s1">"[前] [接] ～まで（ずっと）"</span><span class="s4">, en: </span><span class="s1">"wait till he comes"</span><span class="s4">, ja: </span><span class="s1">"彼が来るまで待つ"</span><span class="s4"> },</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">    </span>{ id: </span><span class="s12">"874"</span><span class="s1">, answer: </span><span class="s12">"within"</span><span class="s1">, explanation: </span><span class="s12">"[前] ～以内で［に］"</span><span class="s1">, en: </span><span class="s12">"within a week"</span><span class="s1">, ja: </span><span class="s12">"1週間以内に"</span><span class="s1"> },</span></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">    </span>{ id: </span><span class="s1">"875"</span><span class="s4">, answer: </span><span class="s1">"without"</span><span class="s4">, explanation: </span><span class="s1">"[前] ～なしで"</span><span class="s4">, en: </span><span class="s1">"coffee without sugar"</span><span class="s4">, ja: </span><span class="s1">"砂糖なしのコーヒー"</span><span class="s4"> },</span></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">    </span>{ id: </span><span class="s1">"876"</span><span class="s4">, answer: </span><span class="s1">"except"</span><span class="s4">, explanation: </span><span class="s1">"[前] ～を除いて"</span><span class="s4">, en: </span><span class="s1">"everyone except me"</span><span class="s4">, ja: </span><span class="s1">"私以外の全員"</span><span class="s4"> },</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">    </span>{ id: </span><span class="s12">"877"</span><span class="s1">, answer: </span><span class="s12">"beside"</span><span class="s1">, explanation: </span><span class="s12">"[前] ～のそばに"</span><span class="s1">, en: </span><span class="s12">"sit beside him"</span><span class="s1">, ja: </span><span class="s12">"彼のそばに座る"</span><span class="s1"> },</span></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">    </span>{ id: </span><span class="s1">"878"</span><span class="s4">, answer: </span><span class="s1">"besides"</span><span class="s4">, explanation: </span><span class="s1">"[前] ①～に加えて　[副] ②その上"</span><span class="s4">, en: </span><span class="s1">"Besides English, he speaks French."</span><span class="s4">, ja: </span><span class="s1">"英語に加えて，彼はフランス語も話す．"</span><span class="s4"> },</span></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">    </span>{ id: </span><span class="s1">"879"</span><span class="s4">, answer: </span><span class="s1">"behind"</span><span class="s4">, explanation: </span><span class="s1">"[前] ①～の後ろに　②～に遅れて"</span><span class="s4">, en: </span><span class="s1">"behind the door"</span><span class="s4">, ja: </span><span class="s1">"ドアの後ろに"</span><span class="s4"> },</span></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">    </span>{ id: </span><span class="s1">"880"</span><span class="s4">, answer: </span><span class="s1">"between"</span><span class="s4">, explanation: </span><span class="s1">"[前] （2つの）間に［で］"</span><span class="s4">, en: </span><span class="s1">"between you and me"</span><span class="s4">, ja: </span><span class="s1">"ここだけの話だが（あなたと私の間で）"</span><span class="s4"> },</span></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">    </span>{ id: </span><span class="s1">"881"</span><span class="s4">, answer: </span><span class="s1">"among"</span><span class="s4">, explanation: </span><span class="s1">"[前] （3つ以上の）間に［で］"</span><span class="s4">, en: </span><span class="s1">"among the students"</span><span class="s4">, ja: </span><span class="s1">"生徒たちの間で"</span><span class="s4"> }</span></p>
<p class="p5"><span class="s1">];</span></p>
<p class="p7"><span class="s10"></span><br></p>
<p class="p7"><span class="s10"></span><br></p>
<p class="p5"><span class="s7">let</span><span class="s1"> activeSentenceElement = </span><span class="s7">null</span><span class="s1">;</span></p>
<p class="p5"><span class="s7">let</span><span class="s1"> selectedSentences = </span><span class="s7">new</span><span class="s1"> </span><span class="s13">Set</span><span class="s1">();</span></p>
<p class="p7"><span class="s10"></span><br></p>
<p class="p8"><span class="s1">// --- DOM Elements ---</span></p>
<p class="p5"><span class="s7">const</span><span class="s1"> sentenceList = document.getElementById(</span><span class="s12">'sentence-list'</span><span class="s1">);</span></p>
<p class="p5"><span class="s7">const</span><span class="s1"> appSubtitle = document.getElementById(</span><span class="s12">'app-subtitle'</span><span class="s1">);</span></p>
<p class="p5"><span class="s7">const</span><span class="s1"> toggleAnswerBtn = document.getElementById(</span><span class="s12">'toggle-answer-btn'</span><span class="s1">);</span></p>
<p class="p5"><span class="s7">const</span><span class="s1"> playSoundBtn = document.getElementById(</span><span class="s12">'play-sound-btn'</span><span class="s1">);</span></p>
<p class="p5"><span class="s7">const</span><span class="s1"> recordBtn = document.getElementById(</span><span class="s12">'record-btn'</span><span class="s1">);</span></p>
<p class="p5"><span class="s7">const</span><span class="s1"> toggleExplanationBtn = document.getElementById(</span><span class="s12">'toggle-explanation-btn'</span><span class="s1">);</span></p>
<p class="p5"><span class="s7">const</span><span class="s1"> startQuizBtn = document.getElementById(</span><span class="s12">'start-quiz-btn'</span><span class="s1">);</span></p>
<p class="p5"><span class="s7">const</span><span class="s1"> messageModal = document.getElementById(</span><span class="s12">'message-modal'</span><span class="s1">);</span></p>
<p class="p5"><span class="s7">const</span><span class="s1"> messageContent = document.getElementById(</span><span class="s12">'message-content'</span><span class="s1">);</span></p>
<p class="p5"><span class="s7">const</span><span class="s1"> quizModal = document.getElementById(</span><span class="s12">'quiz-modal'</span><span class="s1">);</span></p>
<p class="p5"><span class="s7">const</span><span class="s1"> closeQuizBtn = document.getElementById(</span><span class="s12">'close-quiz-btn'</span><span class="s1">);</span></p>
<p class="p5"><span class="s7">const</span><span class="s1"> quizContent = document.getElementById(</span><span class="s12">'quiz-content'</span><span class="s1">);</span></p>
<p class="p5"><span class="s7">const</span><span class="s1"> selectAllCheckbox = document.getElementById(</span><span class="s12">'select-all-checkbox'</span><span class="s1">);</span></p>
<p class="p7"><span class="s10"></span><br></p>
<p class="p5"><span class="s7">const</span><span class="s1"> pdfModal = document.getElementById(</span><span class="s12">'pdf-modal'</span><span class="s1">);</span></p>
<p class="p5"><span class="s7">const</span><span class="s1"> openPdfModalBtn = document.getElementById(</span><span class="s12">'open-pdf-modal-btn'</span><span class="s1">);</span></p>
<p class="p5"><span class="s7">const</span><span class="s1"> closeModalBtn = document.getElementById(</span><span class="s12">'close-modal-btn'</span><span class="s1">);</span></p>
<p class="p7"><span class="s10"></span><br></p>
<p class="p7"><span class="s10"></span><br></p>
<p class="p8"><span class="s1">// --- Voice Synthesis Setup ---</span></p>
<p class="p5"><span class="s7">let</span><span class="s1"> synthesisVoice = </span><span class="s7">null</span><span class="s1">;</span></p>
<p class="p7"><span class="s10"></span><br></p>
<p class="p5"><span class="s7">function</span><span class="s1"> setSynthesisVoice() {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">    </span></span><span class="s7">const</span><span class="s1"> voices = speechSynthesis.getVoices();</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">    </span></span><span class="s7">if</span><span class="s1"> (voices.length &gt; </span><span class="s14">0</span><span class="s1">) {</span></p>
<p class="p8"><span class="s4"><span class="Apple-converted-space">        </span></span><span class="s1">// Prefer Google's voice, then Microsoft's, then any other US English voice</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span>synthesisVoice = voices.find(voice =&gt; voice.name === </span><span class="s12">'Google US English'</span><span class="s1">) ||</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                         </span>voices.find(voice =&gt; voice.lang === </span><span class="s12">'en-US'</span><span class="s1"> &amp;&amp; voice.name.includes(</span><span class="s12">'Google'</span><span class="s1">)) ||</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                         </span>voices.find(voice =&gt; voice.lang === </span><span class="s12">'en-US'</span><span class="s1"> &amp;&amp; voice.name.includes(</span><span class="s12">'Microsoft'</span><span class="s1">)) ||</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                         </span>voices.find(voice =&gt; voice.lang === </span><span class="s12">'en-US'</span><span class="s1">);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">    </span>}</span></p>
<p class="p5"><span class="s1">}</span></p>
<p class="p7"><span class="s10"></span><br></p>
<p class="p8"><span class="s1">// Voices are loaded asynchronously, so we need to listen for the event</span></p>
<p class="p5"><span class="s1">setSynthesisVoice();</span></p>
<p class="p5"><span class="s7">if</span><span class="s1"> (speechSynthesis.onvoiceschanged !== </span><span class="s7">undefined</span><span class="s1">) {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">    </span>speechSynthesis.onvoiceschanged = setSynthesisVoice;</span></p>
<p class="p5"><span class="s1">}</span></p>
<p class="p7"><span class="s10"></span><br></p>
<p class="p7"><span class="s10"></span><br></p>
<p class="p8"><span class="s1">// --- Functions ---</span></p>
<p class="p7"><span class="s10"></span><br></p>
<p class="p8"><span class="s1">/**</span></p>
<p class="p8"><span class="s1">* Finds the specific form of an answer word within a sentence.</span></p>
<p class="p8"><span class="s1">* @param {string} enSentence - The English example sentence.</span></p>
<p class="p8"><span class="s1">* @param {string} answer - The base form of the word.</span></p>
<p class="p8"><span class="s1">* @returns {string|null} - The found word form or null if not found.</span></p>
<p class="p8"><span class="s1">*/</span></p>
<p class="p5"><span class="s7">function</span><span class="s1"> findAnswerFormInSentence(enSentence, answer) {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">    </span></span><span class="s7">const</span><span class="s1"> originalWords = enSentence.split(</span><span class="s12">' '</span><span class="s1">);</span></p>
<p class="p8"><span class="s4"><span class="Apple-converted-space">    </span></span><span class="s1">// \b (単語境界) を使うために、ハイフンなども区切り文字として扱う</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">    </span></span><span class="s7">const</span><span class="s1"> words = enSentence.toLowerCase().split(</span><span class="s6">/[\s,.-?!()]+/</span><span class="s1">);<span class="Apple-converted-space"> </span></span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">    </span></span><span class="s7">const</span><span class="s1"> answerLower = answer.toLowerCase();</span></p>
<p class="p7"><span class="s10"></span><br></p>
<p class="p8"><span class="s4"><span class="Apple-converted-space">    </span></span><span class="s1">// Handle special cases and different forms</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">    </span></span><span class="s7">const</span><span class="s1"> irregularVerbs = {</span></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">        </span></span><span class="s1">'weep'</span><span class="s4">: </span><span class="s1">'wept'</span><span class="s4">,</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s12">'lead'</span><span class="s1">: </span><span class="s12">'led'</span><span class="s1">,</span></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">        </span></span><span class="s1">'stick'</span><span class="s4">: </span><span class="s1">'stuck'</span><span class="s4">,</span></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">        </span></span><span class="s1">'rise'</span><span class="s4">: </span><span class="s1">'rose'</span><span class="s4">,</span></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">        </span></span><span class="s1">'hang'</span><span class="s4">: </span><span class="s1">'hung'</span><span class="s4">,</span></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">        </span></span><span class="s1">'strike'</span><span class="s4">: </span><span class="s1">'struck'</span><span class="s4">,</span></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">        </span></span><span class="s1">'shake'</span><span class="s4">: </span><span class="s1">'shook'</span><span class="s4">,</span></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">        </span></span><span class="s1">'arise'</span><span class="s4">: </span><span class="s1">'arose'</span><span class="s4">,</span></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">        </span></span><span class="s1">'beat'</span><span class="s4">: </span><span class="s1">'beat'</span><span class="s4">,</span></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">        </span></span><span class="s1">'crop'</span><span class="s4">: </span><span class="s1">'cropped'</span><span class="s4">, </span><span class="s9">// crop up</span></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">        </span></span><span class="s1">'survive'</span><span class="s4">: </span><span class="s1">'survived'</span><span class="s4">,</span></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">        </span></span><span class="s1">'feed'</span><span class="s4">: </span><span class="s1">'feed'</span><span class="s4">,</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s12">'run'</span><span class="s1">: </span><span class="s12">'ran'</span><span class="s1">,</span></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">        </span></span><span class="s1">'begin'</span><span class="s4">: </span><span class="s1">'began'</span><span class="s4">,</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s12">'go'</span><span class="s1">: </span><span class="s12">'went'</span><span class="s1">,</span></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">        </span></span><span class="s1">'come'</span><span class="s4">: </span><span class="s1">'came'</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">    </span>};</span></p>
<p class="p7"><span class="s10"></span><br></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">    </span></span><span class="s7">if</span><span class="s1"> (irregularVerbs[answerLower]) {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s7">const</span><span class="s1"> irregularForm = irregularVerbs[answerLower];</span></p>
<p class="p8"><span class="s4"><span class="Apple-converted-space">        </span></span><span class="s1">// 元の単語配列から探す</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s7">const</span><span class="s1"> foundWord = originalWords.find(w =&gt; w.toLowerCase().replace(</span><span class="s6">/[.,!?]$/</span><span class="s1">, </span><span class="s12">''</span><span class="s1">) === irregularForm);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s7">if</span><span class="s1"> (foundWord) </span><span class="s7">return</span><span class="s1"> foundWord;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">    </span>}</span></p>
<p class="p7"><span class="s1"><span class="Apple-converted-space">    </span></span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">    </span></span><span class="s7">for</span><span class="s1"> (</span><span class="s7">let</span><span class="s1"> i = </span><span class="s14">0</span><span class="s1">; i &lt; originalWords.length; i++) {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s7">const</span><span class="s1"> originalWord = originalWords[i];</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s7">const</span><span class="s1"> cleanWord = originalWord.toLowerCase().replace(</span><span class="s6">/[.,!?]$/</span><span class="s1">, </span><span class="s12">''</span><span class="s1">); </span><span class="s9">// 文末の句読点を削除</span></p>
<p class="p7"><span class="s10"></span><br></p>
<p class="p8"><span class="s4"><span class="Apple-converted-space">        </span></span><span class="s1">// Check for various word forms</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s7">if</span><span class="s1"> (</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span>cleanWord === answerLower ||</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span>cleanWord === answerLower + </span><span class="s12">'s'</span><span class="s1"> ||</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span>cleanWord === answerLower + </span><span class="s12">'es'</span><span class="s1"> ||</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span>(answerLower.endsWith(</span><span class="s12">'y'</span><span class="s1">) &amp;&amp; ![</span><span class="s12">'a'</span><span class="s1">, </span><span class="s12">'e'</span><span class="s1">, </span><span class="s12">'i'</span><span class="s1">, </span><span class="s12">'o'</span><span class="s1">, </span><span class="s12">'u'</span><span class="s1">].includes(answerLower.slice(-</span><span class="s14">2</span><span class="s1">, -</span><span class="s14">1</span><span class="s1">))) &amp;&amp; cleanWord === answerLower.slice(</span><span class="s14">0</span><span class="s1">, -</span><span class="s14">1</span><span class="s1">) + </span><span class="s12">'ies'</span><span class="s1"> ||</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span>(answerLower.endsWith(</span><span class="s12">'e'</span><span class="s1">) &amp;&amp; cleanWord === answerLower.slice(</span><span class="s14">0</span><span class="s1">, -</span><span class="s14">1</span><span class="s1">) + </span><span class="s12">'ing'</span><span class="s1">) ||</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span>cleanWord === answerLower + </span><span class="s12">'ing'</span><span class="s1"> ||</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span>cleanWord === answerLower + </span><span class="s12">'ed'</span><span class="s1"> ||</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span>(answerLower.endsWith(</span><span class="s12">'e'</span><span class="s1">) &amp;&amp; cleanWord === answerLower + </span><span class="s12">'d'</span><span class="s1">)</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span>) {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">return</span><span class="s1"> originalWord; </span><span class="s9">// 元の（大文字小文字や句読点を含む）単語を返す</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span>}</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">    </span>}</span></p>
<p class="p7"><span class="s1"><span class="Apple-converted-space">    </span></span></p>
<p class="p8"><span class="s4"><span class="Apple-converted-space">     </span></span><span class="s1">// Fallback</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">     </span></span><span class="s7">if</span><span class="s1">(irregularVerbs[answerLower]) {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">         </span></span><span class="s7">const</span><span class="s1"> irregularForm = irregularVerbs[answerLower];</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">         </span></span><span class="s7">const</span><span class="s1"> foundWord = originalWords.find(w =&gt; w.toLowerCase().includes(irregularForm));</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">         </span></span><span class="s7">if</span><span class="s1">(foundWord) </span><span class="s7">return</span><span class="s1"> foundWord;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">     </span>}</span></p>
<p class="p7"><span class="s10"></span><br></p>
<p class="p8"><span class="s4"><span class="Apple-converted-space">    </span></span><span class="s1">// 最後の手段として、部分一致を探す</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">    </span></span><span class="s7">const</span><span class="s1"> fallback = originalWords.find(w =&gt; w.toLowerCase().includes(answerLower));</span></p>
<p class="p8"><span class="s4"><span class="Apple-converted-space">    </span></span><span class="s7">return</span><span class="s4"> fallback || answer; </span><span class="s1">// Return base answer if no form is found</span></p>
<p class="p5"><span class="s1">}</span></p>
<p class="p7"><span class="s10"></span><br></p>
<p class="p7"><span class="s10"></span><br></p>
<p class="p8"><span class="s1">/**</span></p>
<p class="p8"><span class="s1">* Creates the HTML for a sentence, wrapping the answer word in spans.</span></p>
<p class="p8"><span class="s1">* @param {string} enSentence - The English example sentence from the data.</span></p>
<p class="p8"><span class="s1">* @param {string} answer - The base form of the word to be hidden.</span></p>
<p class="p8"><span class="s1">* @returns {string} - The HTML string for the English sentence.</span></p>
<p class="p8"><span class="s1">*/</span></p>
<p class="p5"><span class="s7">function</span><span class="s1"> formatEnglishSentence(enSentence, answer) {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">    </span></span><span class="s7">const</span><span class="s1"> blank = </span><span class="s12">'__________'</span><span class="s1">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">    </span></span><span class="s7">const</span><span class="s1"> actualWord = findAnswerFormInSentence(enSentence, answer);</span></p>
<p class="p7"><span class="s10"></span><br></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">    </span></span><span class="s7">if</span><span class="s1"> (actualWord) {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s7">const</span><span class="s1"> answerHtml = </span><span class="s12">`&lt;span class="answer-span"&gt;</span><span class="s1">${actualWord}</span><span class="s12">&lt;/span&gt;`</span><span class="s1">;</span></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">        </span></span><span class="s7">const</span><span class="s4"> underlineHtml = </span><span class="s1">`&lt;span class="underline-span"&gt;</span><span class="s4">${blank}</span><span class="s1">&lt;/span&gt;`</span><span class="s4">;</span></p>
<p class="p7"><span class="s1"><span class="Apple-converted-space">        </span></span></p>
<p class="p8"><span class="s4"><span class="Apple-converted-space">        </span></span><span class="s1">// センテンスを単語に分割（句読点も保持）</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s7">const</span><span class="s1"> words = enSentence.split(</span><span class="s12">' '</span><span class="s1">);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s7">let</span><span class="s1"> replaced = </span><span class="s7">false</span><span class="s1">; </span><span class="s9">// 最初の1回だけ置換するためのフラグ</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s7">const</span><span class="s1"> processedWords = words.map(word =&gt; {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">if</span><span class="s1"> (replaced) </span><span class="s7">return</span><span class="s1"> word; </span><span class="s9">// 既に置換済みの場合はそのまま</span></p>
<p class="p7"><span class="s10"></span><br></p>
<p class="p8"><span class="s4"><span class="Apple-converted-space">            </span></span><span class="s1">// "horizon." と "horizon" のように、句読点を除いて一致する場合</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">if</span><span class="s1"> (word.replace(</span><span class="s6">/[.,!?]$/</span><span class="s1">, </span><span class="s12">''</span><span class="s1">) === actualWord.replace(</span><span class="s6">/[.,!?]$/</span><span class="s1">, </span><span class="s12">''</span><span class="s1">)) {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                 </span>replaced = </span><span class="s7">true</span><span class="s1">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                 </span></span><span class="s9">// 元の単語の句読点を保持する</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                 </span></span><span class="s7">const</span><span class="s1"> punctuation = word.match(</span><span class="s6">/[.,!?]$/</span><span class="s1">);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                 </span></span><span class="s7">if</span><span class="s1"> (punctuation) {</span></p>
<p class="p8"><span class="s4"><span class="Apple-converted-space">                     </span></span><span class="s1">// actualWord自体に句読点がない場合</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                     </span></span><span class="s7">const</span><span class="s1"> baseWordHtml = </span><span class="s12">`&lt;span class="answer-span"&gt;</span><span class="s1">${actualWord.replace(</span><span class="s6">/[.,!?]$/</span><span class="s1">, </span><span class="s12">''</span><span class="s1">)}</span><span class="s12">&lt;/span&gt;`</span><span class="s1">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                     </span></span><span class="s7">return</span><span class="s1"> </span><span class="s12">`</span><span class="s1">${baseWordHtml}${underlineHtml}${punctuation[</span><span class="s14">0</span><span class="s1">]}</span><span class="s12">`</span><span class="s1">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                 </span>} </span><span class="s7">else</span><span class="s1"> {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                     </span></span><span class="s7">return</span><span class="s1"> </span><span class="s12">`</span><span class="s1">${answerHtml}${underlineHtml}</span><span class="s12">`</span><span class="s1">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                 </span>}</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span>}</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">return</span><span class="s1"> word; </span><span class="s9">// 一致しない場合はそのまま</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span>});</span></p>
<p class="p7"><span class="s10"></span><br></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s7">let</span><span class="s1"> replacedSentence = processedWords.join(</span><span class="s12">' '</span><span class="s1">);</span></p>
<p class="p7"><span class="s10"></span><br></p>
<p class="p8"><span class="s4"><span class="Apple-converted-space">        </span></span><span class="s1">// 上記のロジックで置換できなかった場合</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s7">if</span><span class="s1"> (!replaced &amp;&amp; enSentence.includes(actualWord)) {</span></p>
<p class="p8"><span class="s4"><span class="Apple-converted-space">             </span></span><span class="s1">// 最初に一致したものだけを置換</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">             </span>replacedSentence = enSentence.replace(actualWord, </span><span class="s12">`</span><span class="s1">${answerHtml}${underlineHtml}</span><span class="s12">`</span><span class="s1">);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span>}</span></p>
<p class="p7"><span class="s1"><span class="Apple-converted-space">        </span></span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s7">return</span><span class="s1"> replacedSentence;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">    </span>}</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">    </span></span><span class="s7">return</span><span class="s1"> enSentence;</span></p>
<p class="p5"><span class="s1">}</span></p>
<p class="p7"><span class="s10"></span><br></p>
<p class="p7"><span class="s10"></span><br></p>
<p class="p8"><span class="s1">/**</span></p>
<p class="p8"><span class="s1">* Renders all sentences for the chapter.</span></p>
<p class="p8"><span class="s1">*/</span></p>
<p class="p5"><span class="s7">function</span><span class="s1"> renderChapter() {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">    </span>sentenceList.innerHTML = </span><span class="s12">''</span><span class="s1">; </span><span class="s9">// Clear existing list</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">    </span></span><span class="s7">if</span><span class="s1"> (chapterData.length === </span><span class="s14">0</span><span class="s1">) {</span></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">        </span>sentenceList.innerHTML = </span><span class="s1">'&lt;p class="text-center text-gray-500"&gt;データがありません。用例を追加してください。&lt;/p&gt;'</span><span class="s4">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s7">return</span><span class="s1">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">    </span>}</span></p>
<p class="p7"><span class="s10"></span><br></p>
<p class="p8"><span class="s4"><span class="Apple-converted-space">    </span></span><span class="s1">// データのクリーニング（説明文から不要なタグを削除）</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">    </span>chapterData.forEach(item =&gt; {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s7">if</span><span class="s1"> (item.explanation) {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span>item.explanation = item.explanation.replace(</span><span class="s6">/\{D:\d+\}/</span><span class="s7">g</span><span class="s1">, </span><span class="s12">''</span><span class="s1">);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span>}</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">    </span>});</span></p>
<p class="p7"><span class="s10"></span><br></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">    </span>chapterData.forEach(item =&gt; {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s7">const</span><span class="s1"> sentenceDiv = document.createElement(</span><span class="s12">'div'</span><span class="s1">);</span></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">        </span>sentenceDiv.className = </span><span class="s1">'sentence-item p-4 border border-gray-200 rounded-lg bg-white transition-shadow duration-300 hover:shadow-md'</span><span class="s4">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span>sentenceDiv.dataset.id = item.id;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span>sentenceDiv.dataset.fullSentence = item.en;</span></p>
<p class="p7"><span class="s10"></span><br></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s7">const</span><span class="s1"> englishSentenceHtml = formatEnglishSentence(item.en, item.answer);</span></p>
<p class="p7"><span class="s10"></span><br></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span>sentenceDiv.innerHTML = </span><span class="s12">`</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">        </span>&lt;div class="flex items-start space-x-4"&gt;</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">            </span>&lt;input type="checkbox" class="sentence-checkbox mt-1 h-5 w-5 rounded border-gray-300 text-indigo-600 focus:ring-indigo-500" data-id="</span><span class="s4">${item.id}</span><span class="s1">"&gt;</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">            </span>&lt;span class="text-lg font-bold text-gray-500"&gt;</span><span class="s4">${item.id}</span><span class="s1">&lt;/span&gt;</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">            </span>&lt;div class="flex-1 cursor-pointer"&gt;</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">                </span>&lt;p class="mb-2 text-gray-700"&gt;</span><span class="s4">${item.ja}</span><span class="s1">&lt;/p&gt;</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">                </span>&lt;p class="font-english"&gt;</span><span class="s4">${englishSentenceHtml}</span><span class="s1">&lt;/p&gt;</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">                </span>&lt;div class="explanation mt-4 p-4 bg-yellow-100 border-l-4 border-yellow-400 text-gray-700 rounded-r-lg"&gt;</span></p>
<p class="p5"><span class="s12"><span class="Apple-converted-space">                </span></span><span class="s1">${item.explanation}</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">                </span>&lt;/div&gt;</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">            </span>&lt;/div&gt;</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">        </span>&lt;/div&gt;</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">        </span>`</span><span class="s4">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span>sentenceList.appendChild(sentenceDiv);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">    </span>});</span></p>
<p class="p7"><span class="s1"><span class="Apple-converted-space">    </span></span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">    </span>document.querySelectorAll(</span><span class="s12">'.sentence-item .flex-1'</span><span class="s1">).forEach(item =&gt; {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span>item.addEventListener(</span><span class="s12">'click'</span><span class="s1">, (e) =&gt; {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">             </span></span><span class="s7">const</span><span class="s1"> sentenceWrapper = e.currentTarget.closest(</span><span class="s12">'.sentence-item'</span><span class="s1">);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">if</span><span class="s1"> (activeSentenceElement) {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>activeSentenceElement.classList.remove(</span><span class="s12">'ring-2'</span><span class="s1">, </span><span class="s12">'ring-blue-400'</span><span class="s1">, </span><span class="s12">'shadow-xl'</span><span class="s1">);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span>}</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span>activeSentenceElement = sentenceWrapper;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span>activeSentenceElement.classList.add(</span><span class="s12">'ring-2'</span><span class="s1">, </span><span class="s12">'ring-blue-400'</span><span class="s1">, </span><span class="s12">'shadow-xl'</span><span class="s1">);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span>});</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">    </span>});</span></p>
<p class="p7"><span class="s10"></span><br></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">    </span>document.querySelectorAll(</span><span class="s12">'.sentence-checkbox'</span><span class="s1">).forEach(checkbox =&gt; {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span>checkbox.addEventListener(</span><span class="s12">'click'</span><span class="s1">, (e) =&gt; {</span></p>
<p class="p8"><span class="s4"><span class="Apple-converted-space">            </span>e.stopPropagation(); </span><span class="s1">// Prevent sentence selection when clicking checkbox</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">const</span><span class="s1"> sentenceId = e.target.dataset.id;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">if</span><span class="s1"> (e.target.checked) {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>selectedSentences.add(sentenceId);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span>} </span><span class="s7">else</span><span class="s1"> {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>selectedSentences.</span><span class="s7">delete</span><span class="s1">(sentenceId);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span>}</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span>});</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">    </span>});</span></p>
<p class="p7"><span class="s1"><span class="Apple-converted-space">    </span></span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">    </span></span><span class="s7">if</span><span class="s1"> (sentenceList.firstChild &amp;&amp; sentenceList.firstChild.querySelector(</span><span class="s12">'.flex-1'</span><span class="s1">)) {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span>sentenceList.firstChild.querySelector(</span><span class="s12">'.flex-1'</span><span class="s1">).click();</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">    </span>}</span></p>
<p class="p5"><span class="s1">}</span></p>
<p class="p8"><span class="s1">/**</span></p>
<p class="p8"><span class="s1">* Shows a message in a modal.</span></p>
<p class="p8"><span class="s1">* @param {string} htmlContent - The HTML content for the message.</span></p>
<p class="p8"><span class="s1">* @param {number} duration - Optional duration in ms to auto-hide.</span></p>
<p class="p8"><span class="s1">*/</span></p>
<p class="p5"><span class="s7">function</span><span class="s1"> showMessage(htmlContent, duration = </span><span class="s7">null</span><span class="s1">) {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">    </span>messageContent.innerHTML = htmlContent;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">    </span>messageModal.classList.remove(</span><span class="s12">'hidden'</span><span class="s1">);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">    </span></span><span class="s7">if</span><span class="s1"> (duration) {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span>setTimeout(() =&gt; {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">if</span><span class="s1"> (!messageModal.classList.contains(</span><span class="s12">'hidden'</span><span class="s1">)) {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                 </span>messageModal.classList.add(</span><span class="s12">'hidden'</span><span class="s1">);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span>}</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span>}, duration);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">    </span>}</span></p>
<p class="p5"><span class="s1">}</span></p>
<p class="p7"><span class="s10"></span><br></p>
<p class="p7"><span class="s10"></span><br></p>
<p class="p8"><span class="s1">/**</span></p>
<p class="p8"><span class="s1">* Plays the audio for the currently selected sentence.</span></p>
<p class="p8"><span class="s1">*/</span></p>
<p class="p5"><span class="s7">function</span><span class="s1"> playSound() {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">    </span></span><span class="s7">if</span><span class="s1"> (!activeSentenceElement) {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span>showMessage(</span><span class="s12">'&lt;p&gt;文を選択してください。&lt;/p&gt;'</span><span class="s1">, </span><span class="s14">2000</span><span class="s1">);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s7">return</span><span class="s1">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">    </span>}</span></p>
<p class="p7"><span class="s10"></span><br></p>
<p class="p8"><span class="s4"><span class="Apple-converted-space">    </span></span><span class="s1">// Attempt to set the voice again in case it was not loaded initially</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">    </span></span><span class="s7">if</span><span class="s1"> (!synthesisVoice) {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span>setSynthesisVoice();</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">    </span>}</span></p>
<p class="p7"><span class="s10"></span><br></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">    </span>speechSynthesis.cancel();</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">    </span></span><span class="s7">const</span><span class="s1"> textToSpeak = activeSentenceElement.dataset.fullSentence;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">    </span></span><span class="s7">const</span><span class="s1"> utterance = </span><span class="s7">new</span><span class="s1"> </span><span class="s13">SpeechSynthesisUtterance</span><span class="s1">(textToSpeak);</span></p>
<p class="p7"><span class="s10"></span><br></p>
<p class="p8"><span class="s4"><span class="Apple-converted-space">    </span></span><span class="s1">// Set language and voice</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">    </span>utterance.lang = </span><span class="s12">'en-US'</span><span class="s1">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">    </span></span><span class="s7">if</span><span class="s1"> (synthesisVoice) {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span>utterance.voice = synthesisVoice;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">    </span>}</span></p>
<p class="p7"><span class="s10"></span><br></p>
<p class="p8"><span class="s4"><span class="Apple-converted-space">    </span></span><span class="s1">// Set rate and pitch for a more natural sound</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">    </span>utterance.rate = </span><span class="s14">1.0</span><span class="s1">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">    </span>utterance.pitch = </span><span class="s14">1.0</span><span class="s1">;</span></p>
<p class="p7"><span class="s1"><span class="Apple-converted-space">    </span></span></p>
<p class="p8"><span class="s4"><span class="Apple-converted-space">    </span></span><span class="s1">// エラーハンドリング</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">    </span>utterance.onerror = (event) =&gt; {</span></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">        </span>console.error(</span><span class="s1">'SpeechSynthesisUtterance.onerror'</span><span class="s4">, event);</span></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">        </span>showMessage(</span><span class="s1">'&lt;p&gt;音声の再生中にエラーが発生しました。&lt;/p&gt;'</span><span class="s4">, </span><span class="s14">3000</span><span class="s4">);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">    </span>};</span></p>
<p class="p7"><span class="s10"></span><br></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">    </span>speechSynthesis.speak(utterance);</span></p>
<p class="p5"><span class="s1">}</span></p>
<p class="p7"><span class="s10"></span><br></p>
<p class="p7"><span class="s10"></span><br></p>
<p class="p8"><span class="s1">/**</span></p>
<p class="p8"><span class="s1">* Handles the recording and evaluation process.</span></p>
<p class="p8"><span class="s1">*/</span></p>
<p class="p5"><span class="s7">function</span><span class="s1"> handleRecording() {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">    </span></span><span class="s7">if</span><span class="s1"> (!activeSentenceElement) {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span>showMessage(</span><span class="s12">'&lt;p&gt;文を選択してください。&lt;/p&gt;'</span><span class="s1">, </span><span class="s14">2000</span><span class="s1">);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s7">return</span><span class="s1">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">    </span>}</span></p>
<p class="p7"><span class="s10"></span><br></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">    </span>speechSynthesis.cancel();</span></p>
<p class="p7"><span class="s10"></span><br></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">    </span></span><span class="s7">const</span><span class="s1"> </span><span class="s13">SpeechRecognition</span><span class="s1"> = window.</span><span class="s13">SpeechRecognition</span><span class="s1"> || window.webkitSpeechRecognition;</span></p>
<p class="p10"><span class="s4"><span class="Apple-converted-space">    </span></span><span class="s7">if</span><span class="s4"> (!</span><span class="s1">SpeechRecognition</span><span class="s4">) {</span></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">        </span>showMessage(</span><span class="s1">'&lt;p&gt;お使いのブラウザは音声認識に対応していません。&lt;/p&gt;'</span><span class="s4">, </span><span class="s14">3000</span><span class="s4">);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s7">return</span><span class="s1">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">    </span>}</span></p>
<p class="p7"><span class="s10"></span><br></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">    </span></span><span class="s7">try</span><span class="s1"> {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s7">const</span><span class="s1"> recognition = </span><span class="s7">new</span><span class="s1"> </span><span class="s13">SpeechRecognition</span><span class="s1">();</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span>recognition.lang = </span><span class="s12">'en-US'</span><span class="s1">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span>recognition.interimResults = </span><span class="s7">false</span><span class="s1">;</span></p>
<p class="p7"><span class="s10"></span><br></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span>recognition.onstart = () =&gt; {</span></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">             </span>showMessage(</span><span class="s1">'&lt;p class="text-2xl"&gt;マイクに向かって話してください...&lt;/p&gt;&lt;div class="animate-pulse text-red-500 text-4xl mt-4"&gt;●&lt;/div&gt;'</span><span class="s4">);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span>};</span></p>
<p class="p7"><span class="s10"></span><br></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span>recognition.onresult = (event) =&gt; {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">const</span><span class="s1"> transcript = event.results[</span><span class="s14">0</span><span class="s1">][</span><span class="s14">0</span><span class="s1">].transcript;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span>evaluatePronunciation(transcript);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span>};</span></p>
<p class="p7"><span class="s10"></span><br></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span>recognition.onerror = (event) =&gt; {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">let</span><span class="s1"> errorMessage = </span><span class="s12">'エラーが発生しました'</span><span class="s1">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">if</span><span class="s1"> (event.error === </span><span class="s12">'no-speech'</span><span class="s1">) {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>errorMessage = </span><span class="s12">'音声が認識されませんでした。もう一度お試しください。'</span><span class="s1">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span>} </span><span class="s7">else</span><span class="s1"> </span><span class="s7">if</span><span class="s1"> (event.error === </span><span class="s12">'not-allowed'</span><span class="s1"> || event.error === </span><span class="s12">'service-not-allowed'</span><span class="s1">) {</span></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">                </span>errorMessage = </span><span class="s1">'マイクの使用が許可されていません。ブラウザのアドレスバーの横にあるアイコンからマイクを許可してください。'</span><span class="s4">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span>} </span><span class="s7">else</span><span class="s1"> </span><span class="s7">if</span><span class="s1"> (event.error === </span><span class="s12">'audio-capture'</span><span class="s1">) {</span></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">                </span>errorMessage = </span><span class="s1">'マイクに問題が発生しました。他のアプリで使用中でないか確認してください。'</span><span class="s4">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span>}</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span>showMessage(</span><span class="s12">`&lt;p&gt;</span><span class="s1">${errorMessage}</span><span class="s12">&lt;/p&gt;`</span><span class="s1">, </span><span class="s14">5000</span><span class="s1">);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span>};</span></p>
<p class="p7"><span class="s1"><span class="Apple-converted-space">        </span></span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span>recognition.onend = () =&gt; {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">             </span></span><span class="s7">if</span><span class="s1"> (messageContent.innerHTML.includes(</span><span class="s12">'マイクに向かって話してください'</span><span class="s1">)) {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>messageModal.classList.add(</span><span class="s12">'hidden'</span><span class="s1">);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">             </span>}</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span>};</span></p>
<p class="p7"><span class="s10"></span><br></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span>recognition.start();</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">    </span>} </span><span class="s7">catch</span><span class="s1"> (e) {</span></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">        </span>showMessage(</span><span class="s1">'&lt;p&gt;音声認識の開始中に予期せぬエラーが発生しました。&lt;/p&gt;'</span><span class="s4">, </span><span class="s14">3000</span><span class="s4">);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span>console.error(</span><span class="s12">"Speech Recognition Error:"</span><span class="s1">, e);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">    </span>}</span></p>
<p class="p5"><span class="s1">}</span></p>
<p class="p8"><span class="s1">/**</span></p>
<p class="p8"><span class="s1">* Evaluates the pronunciation by comparing the transcript to the original sentence.</span></p>
<p class="p8"><span class="s1">*/</span></p>
<p class="p5"><span class="s7">function</span><span class="s1"> evaluatePronunciation(transcript) {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">    </span></span><span class="s7">const</span><span class="s1"> originalText = activeSentenceElement.dataset.fullSentence;</span></p>
<p class="p7"><span class="s10"></span><br></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">    </span></span><span class="s7">const</span><span class="s1"> cleanOrig = originalText.toLowerCase().replace(</span><span class="s6">/[^\w\s']/</span><span class="s7">g</span><span class="s1">, </span><span class="s12">''</span><span class="s1">).split(</span><span class="s12">' '</span><span class="s1">).filter(</span><span class="s13">Boolean</span><span class="s1">); </span><span class="s9">// アポストロフィを許可</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">    </span></span><span class="s7">const</span><span class="s1"> cleanTrans = transcript.toLowerCase().replace(</span><span class="s6">/[^\w\s']/</span><span class="s7">g</span><span class="s1">, </span><span class="s12">''</span><span class="s1">).split(</span><span class="s12">' '</span><span class="s1">).filter(</span><span class="s13">Boolean</span><span class="s1">);</span></p>
<p class="p7"><span class="s1"><span class="Apple-converted-space">    </span></span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">    </span></span><span class="s7">let</span><span class="s1"> matches = </span><span class="s14">0</span><span class="s1">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">    </span></span><span class="s7">const</span><span class="s1"> transWords = </span><span class="s7">new</span><span class="s1"> </span><span class="s13">Set</span><span class="s1">(cleanTrans);</span></p>
<p class="p7"><span class="s1"><span class="Apple-converted-space">    </span></span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">    </span>cleanOrig.forEach(word =&gt; {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s7">if</span><span class="s1"> (transWords.has(word)) {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span>matches++;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span>transWords.</span><span class="s7">delete</span><span class="s1">(word); </span><span class="s9">// 一致した単語はセットから削除 (重複評価を防ぐ)</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span>}</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">    </span>});</span></p>
<p class="p7"><span class="s10"></span><br></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">    </span></span><span class="s7">const</span><span class="s1"> similarity = cleanOrig.length &gt; </span><span class="s14">0</span><span class="s1"> ? (matches / cleanOrig.length) : </span><span class="s14">0</span><span class="s1">;</span></p>
<p class="p7"><span class="s1"><span class="Apple-converted-space">    </span></span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">    </span></span><span class="s7">let</span><span class="s1"> score;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">    </span></span><span class="s7">if</span><span class="s1"> (similarity &gt;= </span><span class="s14">0.9</span><span class="s1">) {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span>score = </span><span class="s14">95</span><span class="s1"> + </span><span class="s13">Math</span><span class="s1">.floor(</span><span class="s13">Math</span><span class="s1">.random() * </span><span class="s14">6</span><span class="s1">); </span><span class="s9">// 95-100</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">    </span>} </span><span class="s7">else</span><span class="s1"> </span><span class="s7">if</span><span class="s1"> (similarity &gt;= </span><span class="s14">0.7</span><span class="s1">) {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span>score = </span><span class="s14">88</span><span class="s1"> + </span><span class="s13">Math</span><span class="s1">.floor(</span><span class="s13">Math</span><span class="s1">.random() * </span><span class="s14">7</span><span class="s1">); </span><span class="s9">// 88-94</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">    </span>} </span><span class="s7">else</span><span class="s1"> </span><span class="s7">if</span><span class="s1"> (similarity &gt;= </span><span class="s14">0.5</span><span class="s1">) {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span>score = </span><span class="s14">80</span><span class="s1"> + </span><span class="s13">Math</span><span class="s1">.floor(</span><span class="s13">Math</span><span class="s1">.random() * </span><span class="s14">8</span><span class="s1">); </span><span class="s9">// 80-87</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">    </span>} </span><span class="s7">else</span><span class="s1"> </span><span class="s7">if</span><span class="s1"> (similarity &gt;= </span><span class="s14">0.3</span><span class="s1">) {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span>score = </span><span class="s14">70</span><span class="s1"> + </span><span class="s13">Math</span><span class="s1">.floor(</span><span class="s13">Math</span><span class="s1">.random() * </span><span class="s14">10</span><span class="s1">); </span><span class="s9">// 70-79</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">    </span>} </span><span class="s7">else</span><span class="s1"> {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span>score = </span><span class="s14">60</span><span class="s1"> + </span><span class="s13">Math</span><span class="s1">.floor(</span><span class="s13">Math</span><span class="s1">.random() * </span><span class="s14">10</span><span class="s1">); </span><span class="s9">// 60-69</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">    </span>}</span></p>
<p class="p7"><span class="s10"></span><br></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">    </span></span><span class="s7">if</span><span class="s1"> (score &gt; </span><span class="s14">100</span><span class="s1">) score = </span><span class="s14">100</span><span class="s1">;</span></p>
<p class="p7"><span class="s10"></span><br></p>
<p class="p7"><span class="s10"></span><br></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">    </span></span><span class="s7">const</span><span class="s1"> messageHtml = </span><span class="s12">`</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">    </span>&lt;h3 class="text-2xl font-bold mb-4"&gt;評価結果&lt;/h3&gt;</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">    </span>&lt;p class="text-7xl font-bold text-blue-600 mb-4"&gt;</span><span class="s4">${score}</span><span class="s1">&lt;span class="text-2xl"&gt;点&lt;/span&gt;&lt;/p&gt;</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">    </span>&lt;p class="text-gray-600 mb-2"&gt;&lt;strong&gt;あなたの発音:&lt;/strong&gt; </span><span class="s4">${transcript}</span><span class="s1">&lt;/p&gt;</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">    </span>&lt;p class="text-gray-600"&gt;&lt;strong&gt;元の文:&lt;/strong&gt; </span><span class="s4">${originalText}</span><span class="s1">&lt;/p&gt;</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">    </span>&lt;button onclick="document.getElementById('message-modal').classList.add('hidden')" class="mt-6 bg-blue-500 text-white py-2 px-6 rounded-lg"&gt;閉じる&lt;/button&gt;</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">    </span>`</span><span class="s4">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">    </span>showMessage(messageHtml);</span></p>
<p class="p5"><span class="s1">}</span></p>
<p class="p7"><span class="s10"></span><br></p>
<p class="p7"><span class="s10"></span><br></p>
<p class="p8"><span class="s1">/**</span></p>
<p class="p8"><span class="s1">* Starts the quiz.</span></p>
<p class="p8"><span class="s1">*/</span></p>
<p class="p5"><span class="s7">function</span><span class="s1"> startQuiz() {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">    </span></span><span class="s7">if</span><span class="s1"> (chapterData.length &lt; </span><span class="s14">10</span><span class="s1">) {</span></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">        </span>showMessage(</span><span class="s1">'&lt;p&gt;クイズを作成するには、データが10個以上必要です。&lt;/p&gt;'</span><span class="s4">, </span><span class="s14">3000</span><span class="s4">);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s7">return</span><span class="s1">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">    </span>}</span></p>
<p class="p7"><span class="s10"></span><br></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">    </span></span><span class="s7">const</span><span class="s1"> uniqueAnswers = [...</span><span class="s7">new</span><span class="s1"> </span><span class="s13">Map</span><span class="s1">(chapterData.map(item =&gt; [item.answer, item])).values()];</span></p>
<p class="p7"><span class="s1"><span class="Apple-converted-space">    </span></span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">    </span></span><span class="s7">if</span><span class="s1"> (uniqueAnswers.length &lt; </span><span class="s14">4</span><span class="s1">) {</span></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">        </span>showMessage(</span><span class="s1">'&lt;p&gt;クイズの選択肢を作成するには、異なる単語が4つ以上必要です。&lt;/p&gt;'</span><span class="s4">, </span><span class="s14">3000</span><span class="s4">);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s7">return</span><span class="s1">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">    </span>}</span></p>
<p class="p7"><span class="s10"></span><br></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">    </span></span><span class="s7">const</span><span class="s1"> shuffled = uniqueAnswers.sort(() =&gt; </span><span class="s14">0.5</span><span class="s1"> - </span><span class="s13">Math</span><span class="s1">.random());</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">    </span></span><span class="s7">const</span><span class="s1"> questions = shuffled.slice(</span><span class="s14">0</span><span class="s1">, </span><span class="s14">10</span><span class="s1">); </span><span class="s9">// 最大10問</span></p>
<p class="p7"><span class="s10"></span><br></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">    </span></span><span class="s7">let</span><span class="s1"> currentQuestionIndex = </span><span class="s14">0</span><span class="s1">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">    </span></span><span class="s7">let</span><span class="s1"> score = </span><span class="s14">0</span><span class="s1">;</span></p>
<p class="p7"><span class="s10"></span><br></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">    </span></span><span class="s7">function</span><span class="s1"> showQuestion() {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s7">if</span><span class="s1"> (currentQuestionIndex &gt;= questions.length) {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span>showQuizResult();</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">return</span><span class="s1">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span>}</span></p>
<p class="p7"><span class="s10"></span><br></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s7">const</span><span class="s1"> question = questions[currentQuestionIndex];</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s7">const</span><span class="s1"> baseAnswer = question.answer;</span></p>
<p class="p7"><span class="s10"></span><br></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s7">const</span><span class="s1"> correctOptionText = findAnswerFormInSentence(question.en, baseAnswer) || baseAnswer;</span></p>
<p class="p7"><span class="s1"><span class="Apple-converted-space">        </span></span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s7">let</span><span class="s1"> questionSentence = question.en;</span></p>
<p class="p7"><span class="s1"><span class="Apple-converted-space">        </span></span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s7">const</span><span class="s1"> words = question.en.split(</span><span class="s12">' '</span><span class="s1">);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s7">let</span><span class="s1"> replaced = </span><span class="s7">false</span><span class="s1">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s7">const</span><span class="s1"> processedWords = words.map(word =&gt; {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">if</span><span class="s1"> (replaced) </span><span class="s7">return</span><span class="s1"> word;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">if</span><span class="s1"> (word === correctOptionText || word.replace(</span><span class="s6">/[.,!?]$/</span><span class="s1">, </span><span class="s12">''</span><span class="s1">) === correctOptionText.replace(</span><span class="s6">/[.,!?]$/</span><span class="s1">, </span><span class="s12">''</span><span class="s1">)) {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>replaced = </span><span class="s7">true</span><span class="s1">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s7">const</span><span class="s1"> punctuation = word.match(</span><span class="s6">/[.,!?]$/</span><span class="s1">);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s7">return</span><span class="s1"> </span><span class="s12">'(______)'</span><span class="s1"> + (punctuation ? punctuation[</span><span class="s14">0</span><span class="s1">] : </span><span class="s12">''</span><span class="s1">);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span>}</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">return</span><span class="s1"> word;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span>});</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span>questionSentence = processedWords.join(</span><span class="s12">' '</span><span class="s1">);</span></p>
<p class="p7"><span class="s1"><span class="Apple-converted-space">        </span></span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s7">if</span><span class="s1"> (!replaced) {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span>questionSentence = question.en.replace(correctOptionText, </span><span class="s12">'(______)'</span><span class="s1">);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span>}</span></p>
<p class="p7"><span class="s10"></span><br></p>
<p class="p7"><span class="s10"></span><br></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s7">const</span><span class="s1"> incorrectAnswers = [...</span><span class="s7">new</span><span class="s1"> </span><span class="s13">Set</span><span class="s1">(chapterData.map(item =&gt; item.answer))]</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span>.filter(answer =&gt; answer !== baseAnswer)</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span>.sort(() =&gt; </span><span class="s14">0.5</span><span class="s1"> - </span><span class="s13">Math</span><span class="s1">.random())</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span>.slice(</span><span class="s14">0</span><span class="s1">, </span><span class="s14">3</span><span class="s1">);</span></p>
<p class="p7"><span class="s10"></span><br></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s7">const</span><span class="s1"> options = [correctOptionText, ...incorrectAnswers].sort(() =&gt; </span><span class="s14">0.5</span><span class="s1"> - </span><span class="s13">Math</span><span class="s1">.random());</span></p>
<p class="p7"><span class="s10"></span><br></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span>quizContent.innerHTML = </span><span class="s12">`</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">        </span>&lt;h3 class="text-2xl font-bold mb-2"&gt;問題 </span><span class="s4">${currentQuestionIndex + </span><span class="s14">1</span><span class="s4">}</span><span class="s1">/</span><span class="s4">${questions.length}</span><span class="s1">&lt;/h3&gt;</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">        </span>&lt;p class="text-lg mb-4"&gt;</span><span class="s4">${question.ja}</span><span class="s1">&lt;/p&gt;</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">        </span>&lt;p class="font-english text-xl mb-6 p-4 bg-gray-100 rounded-lg"&gt;</span><span class="s4">${questionSentence}</span><span class="s1">&lt;/p&gt;</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">        </span>&lt;div class="grid grid-cols-1 md:grid-cols-2 gap-4"&gt;</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s4">${options.map(opt =&gt; </span><span class="s1">`&lt;button class="quiz-option p-4 bg-blue-100 hover:bg-blue-200 rounded-lg text-left text-lg font-english" data-option-text="</span><span class="s4">${opt}</span><span class="s1">"&gt;</span><span class="s4">${opt}</span><span class="s1">&lt;/button&gt;`</span><span class="s4">).join(</span><span class="s1">''</span><span class="s4">)}</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">        </span>&lt;/div&gt;</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">        </span>`</span><span class="s4">;</span></p>
<p class="p7"><span class="s10"></span><br></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span>document.querySelectorAll(</span><span class="s12">'.quiz-option'</span><span class="s1">).forEach(button =&gt; {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span>button.addEventListener(</span><span class="s12">'click'</span><span class="s1">, () =&gt; {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s7">const</span><span class="s1"> selectedOptionText = button.dataset.optionText;</span></p>
<p class="p7"><span class="s1"><span class="Apple-converted-space">                </span></span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span></span><span class="s7">if</span><span class="s1"> (selectedOptionText === correctOptionText) {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span>score++;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span>button.classList.add(</span><span class="s12">'bg-green-400'</span><span class="s1">, </span><span class="s12">'text-white'</span><span class="s1">);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>} </span><span class="s7">else</span><span class="s1"> {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span>button.classList.add(</span><span class="s12">'bg-red-400'</span><span class="s1">, </span><span class="s12">'text-white'</span><span class="s1">);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span></span><span class="s7">const</span><span class="s1"> correctButton = document.querySelector(</span><span class="s12">`[data-option-text="</span><span class="s1">${</span><span class="s13">CSS</span><span class="s1">.escape(correctOptionText)}</span><span class="s12">"]`</span><span class="s1">);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span></span><span class="s7">if</span><span class="s1"> (correctButton) {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                        </span>correctButton.classList.add(</span><span class="s12">'bg-green-400'</span><span class="s1">, </span><span class="s12">'text-white'</span><span class="s1">);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span>}</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>}</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>document.querySelectorAll(</span><span class="s12">'.quiz-option'</span><span class="s1">).forEach(btn =&gt; btn.disabled = </span><span class="s7">true</span><span class="s1">);</span></p>
<p class="p7"><span class="s10"></span><br></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>setTimeout(() =&gt; {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span>currentQuestionIndex++;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                    </span>showQuestion();</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>}, </span><span class="s14">1200</span><span class="s1">);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span>});</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span>});</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">    </span>}</span></p>
<p class="p7"><span class="s10"></span><br></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">    </span></span><span class="s7">function</span><span class="s1"> showQuizResult() {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span>quizContent.innerHTML = </span><span class="s12">`</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">        </span>&lt;h3 class="text-3xl font-bold mb-4 text-center"&gt;テスト終了！&lt;/h3&gt;</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">        </span>&lt;p class="text-center text-xl mb-6"&gt;あなたのスコアは...&lt;/p&gt;</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">        </span>&lt;p class="text-center text-7xl font-bold text-purple-600"&gt;</span><span class="s4">${</span><span class="s13">Math</span><span class="s4">.round((score / questions.length) * </span><span class="s14">100</span><span class="s4">)}</span><span class="s1">&lt;span class="text-3xl"&gt;点&lt;/span&gt;&lt;/p&gt;</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">        </span>&lt;p class="text-center text-xl mt-2"&gt;(</span><span class="s4">${questions.length}</span><span class="s1">問中 </span><span class="s4">${score}</span><span class="s1">問正解)&lt;/p&gt;</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">        </span>`</span><span class="s4">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">    </span>}</span></p>
<p class="p7"><span class="s10"></span><br></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">    </span>showQuestion();</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">    </span>quizModal.classList.remove(</span><span class="s12">'hidden'</span><span class="s1">);</span></p>
<p class="p5"><span class="s1">}</span></p>
<p class="p7"><span class="s10"></span><br></p>
<p class="p8"><span class="s1">/**</span></p>
<p class="p8"><span class="s1"><span class="Apple-converted-space"> </span>* Opens a new window with content and triggers the print dialog.</span></p>
<p class="p8"><span class="s1"><span class="Apple-converted-space"> </span>*/</span></p>
<p class="p5"><span class="s7">function</span><span class="s1"> openPrintWindow(bodyContent, title) {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">    </span></span><span class="s7">const</span><span class="s1"> htmlContent = </span><span class="s12">`</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">        </span>&lt;!DOCTYPE html&gt;</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">        </span>&lt;html lang="ja"&gt;</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">        </span>&lt;head&gt;</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">            </span>&lt;meta charset="UTF-8"&gt;</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">            </span>&lt;title&gt;</span><span class="s4">${title}</span><span class="s1">&lt;/title&gt;</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">            </span>&lt;style&gt;</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">                </span>body { font-family: "Hiragino Kaku Gothic ProN", "Meiryo", sans-serif; line-height: 1.8; margin: 25px; }</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">                </span>@media print { .no-print { display: none; } }</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">                </span>h1, h2 { text-align: center; border-bottom: 2px solid #333; padding-bottom: 10px; margin-bottom: 25px; }</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">                </span>ol, ul { list-style-position: inside; padding-left: 0; }</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">                </span>li { margin-bottom: 15px; }</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">                </span>.list-container {<span class="Apple-converted-space"> </span></span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">                    </span>column-count: 2;<span class="Apple-converted-space"> </span></span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">                    </span>column-gap: 40px;<span class="Apple-converted-space"> </span></span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">                </span>}</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">                </span>.list-container li, .list-container p {<span class="Apple-converted-space"> </span></span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">                    </span>-webkit-column-break-inside: avoid;<span class="Apple-converted-space"> </span></span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">                    </span>page-break-inside: avoid;<span class="Apple-converted-space"> </span></span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">                    </span>break-inside: avoid;<span class="Apple-converted-space"> </span></span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">                </span>}</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">                </span>ol li {</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">                     </span>list-style-type: decimal;</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">                     </span>margin-left: 1.5em; /* 番号が見えるように調整 */</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">                </span>}</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">                </span>/* 問題文を改行させないスタイル */</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">                </span>.inline-content {</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">                    </span>display: inline;</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">                </span>}</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">                </span>@media (max-width: 700px) { .list-container { column-count: 1; } }</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">                </span>.answer-key { page-break-before: always; }</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">            </span>&lt;/style&gt;</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">        </span>&lt;/head&gt;</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">        </span>&lt;body&gt;</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">            </span>&lt;h1&gt;</span><span class="s4">${title}</span><span class="s1">&lt;/h1&gt;</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">            </span>&lt;p class="no-print" style="text-align:center;"&gt;</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">                </span>印刷ダイアログが表示されない場合は、ブラウザの印刷機能（Ctrl+PまたはCmd+P）を使用してください。</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">            </span>&lt;/p&gt;</span></p>
<p class="p5"><span class="s12"><span class="Apple-converted-space">            </span></span><span class="s1">${bodyContent}</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">        </span>&lt;/body&gt;</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">        </span>&lt;/html&gt;</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">    </span>`</span><span class="s4">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">    </span></span><span class="s7">const</span><span class="s1"> printWindow = window.open(</span><span class="s12">''</span><span class="s1">, </span><span class="s12">'_blank'</span><span class="s1">);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">    </span></span><span class="s7">if</span><span class="s1"> (!printWindow) {</span></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">        </span>showMessage(</span><span class="s1">'&lt;p&gt;ポップアップウィンドウがブロックされました。ブラウザの設定を確認してください。&lt;/p&gt;'</span><span class="s4">, </span><span class="s14">5000</span><span class="s4">);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s7">return</span><span class="s1">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">    </span>}</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">    </span>printWindow.document.write(htmlContent);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">    </span>printWindow.document.close();</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">    </span>setTimeout(() =&gt; {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span>printWindow.focus(); </span><span class="s9">// Safari対策</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span>printWindow.print();</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">    </span>}, </span><span class="s14">250</span><span class="s1">);</span></p>
<p class="p5"><span class="s1">}</span></p>
<p class="p7"><span class="s10"></span><br></p>
<p class="p7"><span class="s10"></span><br></p>
<p class="p5"><span class="s7">function</span><span class="s1"> getSelectedItems() {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">     </span></span><span class="s7">if</span><span class="s1"> (selectedSentences.size === </span><span class="s14">0</span><span class="s1">) {</span></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">        </span>showMessage(</span><span class="s1">'&lt;p&gt;PDFを作成する問題を選択してください。&lt;/p&gt;'</span><span class="s4">, </span><span class="s14">3000</span><span class="s4">);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s7">return</span><span class="s1"> </span><span class="s7">null</span><span class="s1">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">    </span>}</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">    </span></span><span class="s7">return</span><span class="s1"> </span><span class="s13">Array</span><span class="s1">.</span><span class="s7">from</span><span class="s1">(selectedSentences)</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span>.map(id =&gt; chapterData.find(item =&gt; item.id === id))</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span>.filter(</span><span class="s13">Boolean</span><span class="s1">)<span class="Apple-converted-space"> </span></span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span>.sort((a, b) =&gt; {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">             </span></span><span class="s9">// IDを正しくソート</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">             </span></span><span class="s7">const</span><span class="s1"> aId = a.id.toString();</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">             </span></span><span class="s7">const</span><span class="s1"> bId = b.id.toString();</span></p>
<p class="p7"><span class="s10"></span><br></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">             </span></span><span class="s7">const</span><span class="s1"> aParts = aId.split(</span><span class="s12">'-'</span><span class="s1">).map(s =&gt; parseInt(s.replace(</span><span class="s6">/\D/</span><span class="s7">g</span><span class="s1">, </span><span class="s12">''</span><span class="s1">), </span><span class="s14">10</span><span class="s1">) || </span><span class="s14">0</span><span class="s1">);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">             </span></span><span class="s7">const</span><span class="s1"> bParts = bId.split(</span><span class="s12">'-'</span><span class="s1">).map(s =&gt; parseInt(s.replace(</span><span class="s6">/\D/</span><span class="s7">g</span><span class="s1">, </span><span class="s12">''</span><span class="s1">), </span><span class="s14">10</span><span class="s1">) || </span><span class="s14">0</span><span class="s1">);</span></p>
<p class="p7"><span class="s1"><span class="Apple-converted-space">             </span></span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">             </span></span><span class="s7">if</span><span class="s1"> (aParts[</span><span class="s14">0</span><span class="s1">] !== bParts[</span><span class="s14">0</span><span class="s1">]) {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                 </span></span><span class="s7">return</span><span class="s1"> aParts[</span><span class="s14">0</span><span class="s1">] - bParts[</span><span class="s14">0</span><span class="s1">];</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">             </span>}</span></p>
<p class="p7"><span class="s1"><span class="Apple-converted-space">             </span></span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">             </span></span><span class="s7">const</span><span class="s1"> subA = aParts[</span><span class="s14">1</span><span class="s1">] || </span><span class="s14">0</span><span class="s1">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">             </span></span><span class="s7">const</span><span class="s1"> subB = bParts[</span><span class="s14">1</span><span class="s1">] || </span><span class="s14">0</span><span class="s1">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">             </span></span><span class="s7">return</span><span class="s1"> subA - subB;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span>});</span></p>
<p class="p5"><span class="s1">}</span></p>
<p class="p7"><span class="s10"></span><br></p>
<p class="p7"><span class="s10"></span><br></p>
<p class="p8"><span class="s1">// --- Event Listeners ---</span></p>
<p class="p7"><span class="s10"></span><br></p>
<p class="p5"><span class="s1">toggleAnswerBtn.addEventListener(</span><span class="s12">'click'</span><span class="s1">, () =&gt; {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">    </span></span><span class="s7">if</span><span class="s1"> (!activeSentenceElement) {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span>showMessage(</span><span class="s12">'&lt;p&gt;文を選択してください。&lt;/p&gt;'</span><span class="s1">, </span><span class="s14">2000</span><span class="s1">);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s7">return</span><span class="s1">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">    </span>}</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">    </span>activeSentenceElement.classList.toggle(</span><span class="s12">'show-answer'</span><span class="s1">);</span></p>
<p class="p5"><span class="s1">});</span></p>
<p class="p7"><span class="s10"></span><br></p>
<p class="p5"><span class="s1">toggleExplanationBtn.addEventListener(</span><span class="s12">'click'</span><span class="s1">, () =&gt; {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">    </span></span><span class="s7">if</span><span class="s1"> (!activeSentenceElement) {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span>showMessage(</span><span class="s12">'&lt;p&gt;文を選択してください。&lt;/p&gt;'</span><span class="s1">, </span><span class="s14">2000</span><span class="s1">);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s7">return</span><span class="s1">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">    </span>}</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">    </span></span><span class="s7">const</span><span class="s1"> explanationDiv = activeSentenceElement.querySelector(</span><span class="s12">'.explanation'</span><span class="s1">);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">    </span></span><span class="s7">if</span><span class="s1"> (explanationDiv.style.display === </span><span class="s12">'block'</span><span class="s1">) {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span>explanationDiv.style.display = </span><span class="s12">'none'</span><span class="s1">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">    </span>} </span><span class="s7">else</span><span class="s1"> {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span>explanationDiv.style.display = </span><span class="s12">'block'</span><span class="s1">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">    </span>}</span></p>
<p class="p5"><span class="s1">});</span></p>
<p class="p7"><span class="s10"></span><br></p>
<p class="p5"><span class="s1">selectAllCheckbox.addEventListener(</span><span class="s12">'change'</span><span class="s1">, (e) =&gt; {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">    </span></span><span class="s7">const</span><span class="s1"> isChecked = e.target.checked;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">    </span></span><span class="s7">const</span><span class="s1"> checkboxes = document.querySelectorAll(</span><span class="s12">'.sentence-checkbox'</span><span class="s1">);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">    </span>checkboxes.forEach(checkbox =&gt; {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span>checkbox.checked = isChecked;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s7">const</span><span class="s1"> sentenceId = checkbox.dataset.id;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s7">if</span><span class="s1"> (isChecked) {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span>selectedSentences.add(sentenceId);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span>} </span><span class="s7">else</span><span class="s1"> {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span>selectedSentences.</span><span class="s7">delete</span><span class="s1">(sentenceId);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span>}</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">    </span>});</span></p>
<p class="p5"><span class="s1">});</span></p>
<p class="p7"><span class="s10"></span><br></p>
<p class="p5"><span class="s1">playSoundBtn.addEventListener(</span><span class="s12">'click'</span><span class="s1">, playSound);</span></p>
<p class="p5"><span class="s1">recordBtn.addEventListener(</span><span class="s12">'click'</span><span class="s1">, handleRecording);</span></p>
<p class="p5"><span class="s1">startQuizBtn.addEventListener(</span><span class="s12">'click'</span><span class="s1">, startQuiz);</span></p>
<p class="p5"><span class="s1">closeQuizBtn.addEventListener(</span><span class="s12">'click'</span><span class="s1">, () =&gt; quizModal.classList.add(</span><span class="s12">'hidden'</span><span class="s1">));</span></p>
<p class="p7"><span class="s10"></span><br></p>
<p class="p8"><span class="s1">// PDF Modal Listeners</span></p>
<p class="p5"><span class="s1">openPdfModalBtn.addEventListener(</span><span class="s12">'click'</span><span class="s1">, () =&gt; {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">    </span></span><span class="s7">if</span><span class="s1"> (selectedSentences.size === </span><span class="s14">0</span><span class="s1">) {</span></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">        </span>showMessage(</span><span class="s1">'&lt;p&gt;PDFを作成する問題を選択してください。&lt;/p&gt;'</span><span class="s4">, </span><span class="s14">3000</span><span class="s4">);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s7">return</span><span class="s1">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">    </span>}</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">    </span>pdfModal.classList.remove(</span><span class="s12">'hidden'</span><span class="s1">)</span></p>
<p class="p5"><span class="s1">});</span></p>
<p class="p5"><span class="s1">closeModalBtn.addEventListener(</span><span class="s12">'click'</span><span class="s1">, () =&gt; pdfModal.classList.add(</span><span class="s12">'hidden'</span><span class="s1">));</span></p>
<p class="p7"><span class="s10"></span><br></p>
<p class="p5"><span class="s1">document.getElementById(</span><span class="s12">'download-list-btn'</span><span class="s1">).addEventListener(</span><span class="s12">'click'</span><span class="s1">, () =&gt; {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">    </span></span><span class="s7">const</span><span class="s1"> items = getSelectedItems();</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">    </span></span><span class="s7">if</span><span class="s1"> (!items) </span><span class="s7">return</span><span class="s1">;</span></p>
<p class="p7"><span class="s10"></span><br></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">    </span></span><span class="s7">const</span><span class="s1"> uniqueWords = </span><span class="s7">new</span><span class="s1"> </span><span class="s13">Map</span><span class="s1">();</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">    </span>items.forEach(item =&gt; {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s7">if</span><span class="s1"> (!uniqueWords.has(item.answer)) {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span>uniqueWords.</span><span class="s7">set</span><span class="s1">(item.answer, item);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span>}</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">    </span>});</span></p>
<p class="p8"><span class="s4"><span class="Apple-converted-space">    </span></span><span class="s1">// 抽出順（ID順）にソートするために、MapのValueを一度配列にしてソート</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">    </span></span><span class="s7">const</span><span class="s1"> uniqueItems = </span><span class="s13">Array</span><span class="s1">.</span><span class="s7">from</span><span class="s1">(uniqueWords.values()).sort((a, b) =&gt; {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">         </span></span><span class="s7">const</span><span class="s1"> aId = a.id.toString();</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">         </span></span><span class="s7">const</span><span class="s1"> bId = b.id.toString();</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">         </span></span><span class="s7">const</span><span class="s1"> aParts = aId.split(</span><span class="s12">'-'</span><span class="s1">).map(s =&gt; parseInt(s.replace(</span><span class="s6">/\D/</span><span class="s7">g</span><span class="s1">, </span><span class="s12">''</span><span class="s1">), </span><span class="s14">10</span><span class="s1">) || </span><span class="s14">0</span><span class="s1">);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">         </span></span><span class="s7">const</span><span class="s1"> bParts = bId.split(</span><span class="s12">'-'</span><span class="s1">).map(s =&gt; parseInt(s.replace(</span><span class="s6">/\D/</span><span class="s7">g</span><span class="s1">, </span><span class="s12">''</span><span class="s1">), </span><span class="s14">10</span><span class="s1">) || </span><span class="s14">0</span><span class="s1">);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">         </span></span><span class="s7">return</span><span class="s1"> aParts[</span><span class="s14">0</span><span class="s1">] - bParts[</span><span class="s14">0</span><span class="s1">];</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">    </span>});</span></p>
<p class="p7"><span class="s10"></span><br></p>
<p class="p7"><span class="s10"></span><br></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">    </span></span><span class="s7">const</span><span class="s1"> listItems = uniqueItems.map(item =&gt; </span><span class="s12">`&lt;li&gt;&lt;span class="inline-content"&gt;&lt;strong&gt;</span><span class="s1">${item.answer}</span><span class="s12">&lt;/strong&gt;: </span><span class="s1">${item.explanation.replace(</span><span class="s6">/\n/</span><span class="s7">g</span><span class="s1">, </span><span class="s12">' '</span><span class="s1">)}</span><span class="s12">&lt;/span&gt;&lt;/li&gt;`</span><span class="s1">).join(</span><span class="s12">''</span><span class="s1">);</span></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">    </span>openPrintWindow(</span><span class="s1">`&lt;ul class="list-container"&gt;</span><span class="s4">${listItems}</span><span class="s1">&lt;/ul&gt;`</span><span class="s4">, </span><span class="s1">'重要語句リスト'</span><span class="s4">);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">    </span>pdfModal.classList.add(</span><span class="s12">'hidden'</span><span class="s1">);</span></p>
<p class="p5"><span class="s1">});</span></p>
<p class="p7"><span class="s10"></span><br></p>
<p class="p5"><span class="s1">document.getElementById(</span><span class="s12">'download-en-quiz-btn'</span><span class="s1">).addEventListener(</span><span class="s12">'click'</span><span class="s1">, () =&gt; {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">    </span></span><span class="s7">const</span><span class="s1"> items = getSelectedItems();</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">    </span></span><span class="s7">if</span><span class="s1"> (!items) </span><span class="s7">return</span><span class="s1">;</span></p>
<p class="p7"><span class="s10"></span><br></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">    </span></span><span class="s7">const</span><span class="s1"> uniqueWords = </span><span class="s7">new</span><span class="s1"> </span><span class="s13">Map</span><span class="s1">();</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">    </span>items.forEach(item =&gt; {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s7">if</span><span class="s1"> (!uniqueWords.has(item.answer)) {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span>uniqueWords.</span><span class="s7">set</span><span class="s1">(item.answer, item);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span>}</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">    </span>});</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">    </span></span><span class="s7">const</span><span class="s1"> uniqueItems = </span><span class="s13">Array</span><span class="s1">.</span><span class="s7">from</span><span class="s1">(uniqueWords.values()).sort((a, b) =&gt; {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">         </span></span><span class="s7">const</span><span class="s1"> aId = a.id.toString();</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">         </span></span><span class="s7">const</span><span class="s1"> bId = b.id.toString();</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">         </span></span><span class="s7">const</span><span class="s1"> aParts = aId.split(</span><span class="s12">'-'</span><span class="s1">).map(s =&gt; parseInt(s.replace(</span><span class="s6">/\D/</span><span class="s7">g</span><span class="s1">, </span><span class="s12">''</span><span class="s1">), </span><span class="s14">10</span><span class="s1">) || </span><span class="s14">0</span><span class="s1">);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">         </span></span><span class="s7">const</span><span class="s1"> bParts = bId.split(</span><span class="s12">'-'</span><span class="s1">).map(s =&gt; parseInt(s.replace(</span><span class="s6">/\D/</span><span class="s7">g</span><span class="s1">, </span><span class="s12">''</span><span class="s1">), </span><span class="s14">10</span><span class="s1">) || </span><span class="s14">0</span><span class="s1">);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">         </span></span><span class="s7">return</span><span class="s1"> aParts[</span><span class="s14">0</span><span class="s1">] - bParts[</span><span class="s14">0</span><span class="s1">];</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">    </span>});</span></p>
<p class="p7"><span class="s10"></span><br></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">    </span></span><span class="s7">const</span><span class="s1"> quizItems = uniqueItems.map((item) =&gt; </span><span class="s12">`&lt;li&gt;&lt;span class="inline-content"&gt;</span><span class="s1">${item.explanation.replace(</span><span class="s6">/\n/</span><span class="s7">g</span><span class="s1">, </span><span class="s12">' '</span><span class="s1">)}</span><span class="s12">: _________________________&lt;/span&gt;&lt;/li&gt;`</span><span class="s1">).join(</span><span class="s12">''</span><span class="s1">);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">    </span></span><span class="s7">const</span><span class="s1"> answerItems = uniqueItems.map((item) =&gt; </span><span class="s12">`&lt;li&gt;&lt;span class="inline-content"&gt;</span><span class="s1">${item.answer}</span><span class="s12">&lt;/span&gt;&lt;/li&gt;`</span><span class="s1">).join(</span><span class="s12">''</span><span class="s1">);</span></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">    </span></span><span class="s7">const</span><span class="s4"> bodyContent = </span><span class="s1">`&lt;h2&gt;問題用紙&lt;/h2&gt;&lt;ol class="list-container"&gt;</span><span class="s4">${quizItems}</span><span class="s1">&lt;/ol&gt;&lt;div class="answer-key"&gt;&lt;h2&gt;解答&lt;/h2&gt;&lt;ol class="list-container"&gt;</span><span class="s4">${answerItems}</span><span class="s1">&lt;/ol&gt;&lt;/div&gt;`</span><span class="s4">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">    </span>openPrintWindow(bodyContent, </span><span class="s12">'重要語句テスト (英語を解答)'</span><span class="s1">);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">    </span>pdfModal.classList.add(</span><span class="s12">'hidden'</span><span class="s1">);</span></p>
<p class="p5"><span class="s1">});</span></p>
<p class="p7"><span class="s10"></span><br></p>
<p class="p5"><span class="s1">document.getElementById(</span><span class="s12">'download-ja-quiz-btn'</span><span class="s1">).addEventListener(</span><span class="s12">'click'</span><span class="s1">, () =&gt; {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">    </span></span><span class="s7">const</span><span class="s1"> items = getSelectedItems();</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">    </span></span><span class="s7">if</span><span class="s1"> (!items) </span><span class="s7">return</span><span class="s1">;</span></p>
<p class="p7"><span class="s1"><span class="Apple-converted-space">    </span></span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">    </span></span><span class="s7">const</span><span class="s1"> uniqueWords = </span><span class="s7">new</span><span class="s1"> </span><span class="s13">Map</span><span class="s1">();</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">    </span>items.forEach(item =&gt; {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s7">if</span><span class="s1"> (!uniqueWords.has(item.answer)) {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span>uniqueWords.</span><span class="s7">set</span><span class="s1">(item.answer, item);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span>}</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">    </span>});</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">    </span></span><span class="s7">const</span><span class="s1"> uniqueItems = </span><span class="s13">Array</span><span class="s1">.</span><span class="s7">from</span><span class="s1">(uniqueWords.values()).sort((a, b) =&gt; {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">         </span></span><span class="s7">const</span><span class="s1"> aId = a.id.toString();</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">         </span></span><span class="s7">const</span><span class="s1"> bId = b.id.toString();</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">         </span></span><span class="s7">const</span><span class="s1"> aParts = aId.split(</span><span class="s12">'-'</span><span class="s1">).map(s =&gt; parseInt(s.replace(</span><span class="s6">/\D/</span><span class="s7">g</span><span class="s1">, </span><span class="s12">''</span><span class="s1">), </span><span class="s14">10</span><span class="s1">) || </span><span class="s14">0</span><span class="s1">);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">         </span></span><span class="s7">const</span><span class="s1"> bParts = bId.split(</span><span class="s12">'-'</span><span class="s1">).map(s =&gt; parseInt(s.replace(</span><span class="s6">/\D/</span><span class="s7">g</span><span class="s1">, </span><span class="s12">''</span><span class="s1">), </span><span class="s14">10</span><span class="s1">) || </span><span class="s14">0</span><span class="s1">);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">         </span></span><span class="s7">return</span><span class="s1"> aParts[</span><span class="s14">0</span><span class="s1">] - bParts[</span><span class="s14">0</span><span class="s1">];</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">    </span>});</span></p>
<p class="p7"><span class="s10"></span><br></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">    </span></span><span class="s7">const</span><span class="s4"> quizItems = uniqueItems.map((item) =&gt; </span><span class="s1">`&lt;li&gt;&lt;span class="inline-content"&gt;</span><span class="s4">${item.answer}</span><span class="s1">: _________________________&lt;/span&gt;&lt;/li&gt;`</span><span class="s4">).join(</span><span class="s1">''</span><span class="s4">);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">    </span></span><span class="s7">const</span><span class="s1"> answerItems = uniqueItems.map((item) =&gt; </span><span class="s12">`&lt;li&gt;&lt;span class="inline-content"&gt;</span><span class="s1">${item.explanation.replace(</span><span class="s6">/\n/</span><span class="s7">g</span><span class="s1">, </span><span class="s12">' '</span><span class="s1">)}</span><span class="s12">&lt;/span&gt;&lt;/li&gt;`</span><span class="s1">).join(</span><span class="s12">''</span><span class="s1">);</span></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">    </span></span><span class="s7">const</span><span class="s4"> bodyContent = </span><span class="s1">`&lt;h2&gt;問題用紙&lt;/h2&gt;&lt;ol class="list-container"&gt;</span><span class="s4">${quizItems}</span><span class="s1">&lt;/ol&gt;&lt;div class="answer-key"&gt;&lt;h2&gt;解答&lt;/h2&gt;&lt;ol class="list-container"&gt;</span><span class="s4">${answerItems}</span><span class="s1">&lt;/ol&gt;&lt;/div&gt;`</span><span class="s4">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">    </span>openPrintWindow(bodyContent, </span><span class="s12">'重要語句テスト (日本語を解答)'</span><span class="s1">);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">    </span>pdfModal.classList.add(</span><span class="s12">'hidden'</span><span class="s1">);</span></p>
<p class="p5"><span class="s1">});</span></p>
<p class="p7"><span class="s10"></span><br></p>
<p class="p5"><span class="s1">document.getElementById(</span><span class="s12">'download-mixed-quiz-btn'</span><span class="s1">).addEventListener(</span><span class="s12">'click'</span><span class="s1">, () =&gt; {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">    </span></span><span class="s7">const</span><span class="s1"> items = getSelectedItems();</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">    </span></span><span class="s7">if</span><span class="s1"> (!items) </span><span class="s7">return</span><span class="s1">;</span></p>
<p class="p7"><span class="s10"></span><br></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">    </span></span><span class="s7">const</span><span class="s1"> uniqueWords = </span><span class="s7">new</span><span class="s1"> </span><span class="s13">Map</span><span class="s1">();</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">    </span>items.forEach(item =&gt; {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s7">if</span><span class="s1"> (!uniqueWords.has(item.answer)) {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span>uniqueWords.</span><span class="s7">set</span><span class="s1">(item.answer, item);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span>}</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">    </span>});</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">    </span></span><span class="s7">const</span><span class="s1"> uniqueItems = </span><span class="s13">Array</span><span class="s1">.</span><span class="s7">from</span><span class="s1">(uniqueWords.values()).sort((a, b) =&gt; {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">         </span></span><span class="s7">const</span><span class="s1"> aId = a.id.toString();</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">         </span></span><span class="s7">const</span><span class="s1"> bId = b.id.toString();</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">         </span></span><span class="s7">const</span><span class="s1"> aParts = aId.split(</span><span class="s12">'-'</span><span class="s1">).map(s =&gt; parseInt(s.replace(</span><span class="s6">/\D/</span><span class="s7">g</span><span class="s1">, </span><span class="s12">''</span><span class="s1">), </span><span class="s14">10</span><span class="s1">) || </span><span class="s14">0</span><span class="s1">);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">         </span></span><span class="s7">const</span><span class="s1"> bParts = bId.split(</span><span class="s12">'-'</span><span class="s1">).map(s =&gt; parseInt(s.replace(</span><span class="s6">/\D/</span><span class="s7">g</span><span class="s1">, </span><span class="s12">''</span><span class="s1">), </span><span class="s14">10</span><span class="s1">) || </span><span class="s14">0</span><span class="s1">);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">         </span></span><span class="s7">return</span><span class="s1"> aParts[</span><span class="s14">0</span><span class="s1">] - bParts[</span><span class="s14">0</span><span class="s1">];</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">    </span>});</span></p>
<p class="p7"><span class="s10"></span><br></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">    </span></span><span class="s7">let</span><span class="s1"> quizItems = </span><span class="s12">''</span><span class="s1">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">    </span></span><span class="s7">let</span><span class="s1"> answerItems = </span><span class="s12">''</span><span class="s1">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">    </span>uniqueItems.forEach((item) =&gt; {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s7">if</span><span class="s1"> (</span><span class="s13">Math</span><span class="s1">.random() &gt; </span><span class="s14">0.5</span><span class="s1">) {</span></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">            </span>quizItems += </span><span class="s1">`&lt;li&gt;&lt;span class="inline-content"&gt;</span><span class="s4">${item.explanation.replace(</span><span class="s6">/\n/</span><span class="s7">g</span><span class="s4">, </span><span class="s1">' '</span><span class="s4">)}</span><span class="s1">: _________________________&lt;/span&gt;&lt;/li&gt;`</span><span class="s4">;</span></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">            </span>answerItems += </span><span class="s1">`&lt;li&gt;&lt;span class="inline-content"&gt;</span><span class="s4">${item.answer}</span><span class="s1">&lt;/span&gt;&lt;/li&gt;`</span><span class="s4">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span>} </span><span class="s7">else</span><span class="s1"> {</span></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">            </span>quizItems += </span><span class="s1">`&lt;li&gt;&lt;span class="inline-content"&gt;</span><span class="s4">${item.answer}</span><span class="s1">: _________________________&lt;/span&gt;&lt;/li&gt;`</span><span class="s4">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span>answerItems += </span><span class="s12">`&lt;li&gt;&lt;span class="inline-content"&gt;</span><span class="s1">${item.explanation.replace(</span><span class="s6">/\n/</span><span class="s7">g</span><span class="s1">, </span><span class="s12">' '</span><span class="s1">)}</span><span class="s12">&lt;/span&gt;&lt;/li&gt;`</span><span class="s1">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span>}</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">    </span>});</span></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">    </span></span><span class="s7">const</span><span class="s4"> bodyContent = </span><span class="s1">`&lt;h2&gt;問題用紙&lt;/h2&gt;&lt;ol class="list-container"&gt;</span><span class="s4">${quizItems}</span><span class="s1">&lt;/ol&gt;&lt;div class="answer-key"&gt;&lt;h2&gt;解答&lt;/h2&gt;&lt;ol class="list-container"&gt;</span><span class="s4">${answerItems}</span><span class="s1">&lt;/ol&gt;&lt;/div&gt;`</span><span class="s4">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">    </span>openPrintWindow(bodyContent, </span><span class="s12">'重要語句テスト (混合)'</span><span class="s1">);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">    </span>pdfModal.classList.add(</span><span class="s12">'hidden'</span><span class="s1">);</span></p>
<p class="p5"><span class="s1">});</span></p>
<p class="p7"><span class="s10"></span><br></p>
<p class="p7"><span class="s10"></span><br></p>
<p class="p5"><span class="s1">document.getElementById(</span><span class="s12">'download-sentence-quiz-btn'</span><span class="s1">).addEventListener(</span><span class="s12">'click'</span><span class="s1">, () =&gt; {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">    </span></span><span class="s7">const</span><span class="s1"> items = getSelectedItems();</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">    </span></span><span class="s7">if</span><span class="s1"> (!items) </span><span class="s7">return</span><span class="s1">;</span></p>
<p class="p7"><span class="s1"><span class="Apple-converted-space">    </span></span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">    </span></span><span class="s7">const</span><span class="s1"> quizItems = items.map((item, index) =&gt; {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s7">const</span><span class="s1"> wordInSentence = findAnswerFormInSentence(item.en, item.answer);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s7">let</span><span class="s1"> blankedSentence = item.en;</span></p>
<p class="p7"><span class="s1"><span class="Apple-converted-space">        </span></span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s7">if</span><span class="s1"> (wordInSentence) {</span></p>
<p class="p8"><span class="s4"><span class="Apple-converted-space">             </span></span><span class="s1">// 例文中に単語が見つかった場合のみ置換</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">             </span>blankedSentence = item.en.replace(wordInSentence, </span><span class="s12">'_______________'</span><span class="s1">);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span>}</span></p>
<p class="p7"><span class="s10"></span><br></p>
<p class="p8"><span class="s4"><span class="Apple-converted-space">        </span></span><span class="s1">// 修正: （ヒント: ...）を削除し、日本語訳のみを表示</span></p>
<p class="p8"><span class="s4"><span class="Apple-converted-space">        </span></span><span class="s1">// 同列に表示するため span.inline-content を使用</span></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">        </span></span><span class="s7">return</span><span class="s4"> </span><span class="s1">`&lt;li&gt;&lt;span class="inline-content"&gt;</span><span class="s4">${blankedSentence}</span><span class="s1">&lt;/span&gt;&lt;br&gt;</span><span class="s4">${item.ja}</span><span class="s1">&lt;/li&gt;`</span><span class="s4">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">    </span>}).join(</span><span class="s12">''</span><span class="s1">);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">    </span></span><span class="s7">const</span><span class="s1"> answerItems = items.map((item) =&gt; </span><span class="s12">`&lt;li&gt;&lt;span class="inline-content"&gt;</span><span class="s1">${findAnswerFormInSentence(item.en, item.answer)}</span><span class="s12">&lt;/span&gt;&lt;/li&gt;`</span><span class="s1">).join(</span><span class="s12">''</span><span class="s1">);</span></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">    </span></span><span class="s7">const</span><span class="s4"> bodyContent = </span><span class="s1">`&lt;h2&gt;問題用紙&lt;/h2&gt;&lt;ol&gt;</span><span class="s4">${quizItems}</span><span class="s1">&lt;/ol&gt;&lt;div class="answer-key"&gt;&lt;h2&gt;解答&lt;/h2&gt;&lt;ol class="list-container"&gt;</span><span class="s4">${answerItems}</span><span class="s1">&lt;/ol&gt;&lt;/div&gt;`</span><span class="s4">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">    </span>openPrintWindow(bodyContent, </span><span class="s12">'重要語句テスト (例文穴埋め)'</span><span class="s1">);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">    </span>pdfModal.classList.add(</span><span class="s12">'hidden'</span><span class="s1">);</span></p>
<p class="p5"><span class="s1">});</span></p>
<p class="p7"><span class="s10"></span><br></p>
<p class="p5"><span class="s1">document.getElementById(</span><span class="s12">'download-sentence-mixed-quiz-btn'</span><span class="s1">).addEventListener(</span><span class="s12">'click'</span><span class="s1">, () =&gt; {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">    </span></span><span class="s7">const</span><span class="s1"> items = getSelectedItems();</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">    </span></span><span class="s7">if</span><span class="s1"> (!items) </span><span class="s7">return</span><span class="s1">;</span></p>
<p class="p7"><span class="s10"></span><br></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">    </span></span><span class="s7">let</span><span class="s1"> quizItems = </span><span class="s12">''</span><span class="s1">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">    </span></span><span class="s7">let</span><span class="s1"> answerItems = </span><span class="s12">''</span><span class="s1">;</span></p>
<p class="p7"><span class="s1"><span class="Apple-converted-space">    </span></span></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">    </span></span><span class="s7">const</span><span class="s4"> instructionText = </span><span class="s1">'英語を答える問題は文脈に従ってヒントをもとに英語を、日本語を答える問題は英文の下線部の部分を日本語に直しなさい。'</span><span class="s4">;</span></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">    </span></span><span class="s7">const</span><span class="s4"> generalInstruction = </span><span class="s1">`&lt;p style="text-align: left; border: 1px solid #ccc; padding: 10px; margin-bottom: 20px;"&gt;</span><span class="s4">${instructionText}</span><span class="s1">&lt;/p&gt;`</span><span class="s4">;</span></p>
<p class="p7"><span class="s10"></span><br></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">    </span>items.forEach((item) =&gt; {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s7">const</span><span class="s1"> wordInSentence = findAnswerFormInSentence(item.en, item.answer);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s7">if</span><span class="s1"> (</span><span class="s13">Math</span><span class="s1">.random() &gt; </span><span class="s14">0.5</span><span class="s1">) {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s9">// 穴埋め問題</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">let</span><span class="s1"> blankedSentence = item.en;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">if</span><span class="s1"> (wordInSentence) {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                </span>blankedSentence = item.en.replace(wordInSentence, </span><span class="s12">'_______________'</span><span class="s1">);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span>}</span></p>
<p class="p8"><span class="s4"><span class="Apple-converted-space">            </span></span><span class="s1">// 修正: （ヒント: ...）を削除し、日本語訳のみを表示</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span>quizItems += </span><span class="s12">`&lt;li&gt;&lt;span class="inline-content"&gt;</span><span class="s1">${blankedSentence}</span><span class="s12">&lt;/span&gt;&lt;br&gt;</span><span class="s1">${item.ja}</span><span class="s12">&lt;/li&gt;`</span><span class="s1">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span>answerItems += </span><span class="s12">`&lt;li&gt;&lt;span class="inline-content"&gt;</span><span class="s1">${wordInSentence || item.answer}</span><span class="s12">&lt;/span&gt;&lt;/li&gt;`</span><span class="s1">; </span><span class="s9">// 見つからなければベースアンサー</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span>} </span><span class="s7">else</span><span class="s1"> {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s9">// 和訳問題</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">let</span><span class="s1"> underlinedSentence = item.en;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s7">if</span><span class="s1"> (wordInSentence) {</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">                 </span>underlinedSentence = item.en.replace(wordInSentence, </span><span class="s12">`&lt;u&gt;</span><span class="s1">${wordInSentence}</span><span class="s12">&lt;/u&gt;`</span><span class="s1">);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">            </span>}</span></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">            </span>quizItems += </span><span class="s1">`&lt;li&gt;&lt;span class="inline-content"&gt;</span><span class="s4">${underlinedSentence}</span><span class="s1">&lt;/span&gt;&lt;br&gt;_________________________&lt;/li&gt;`</span><span class="s4">;</span></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">            </span>answerItems += </span><span class="s1">`&lt;li&gt;&lt;span class="inline-content"&gt;</span><span class="s4">${item.ja}</span><span class="s1">&lt;/span&gt;&lt;/li&gt;`</span><span class="s4">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">        </span>}</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">    </span>});</span></p>
<p class="p7"><span class="s10"></span><br></p>
<p class="p6"><span class="s4"><span class="Apple-converted-space">    </span></span><span class="s7">const</span><span class="s4"> bodyContent = </span><span class="s1">`&lt;h2&gt;問題用紙&lt;/h2&gt;</span><span class="s4">${generalInstruction}</span><span class="s1">&lt;ol&gt;</span><span class="s4">${quizItems}</span><span class="s1">&lt;/ol&gt;&lt;div class="answer-key"&gt;&lt;h2&gt;解答&lt;/h2&gt;&lt;ol class="list-container"&gt;</span><span class="s4">${answerItems}</span><span class="s1">&lt;/ol&gt;&lt;/div&gt;`</span><span class="s4">;</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">    </span>openPrintWindow(bodyContent, </span><span class="s12">'重要語句テスト (例文混合)'</span><span class="s1">);</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">    </span>pdfModal.classList.add(</span><span class="s12">'hidden'</span><span class="s1">);</span></p>
<p class="p5"><span class="s1">});</span></p>
<p class="p7"><span class="s10"></span><br></p>
<p class="p7"><span class="s10"></span><br></p>
<p class="p8"><span class="s1">// --- Initial Load ---</span></p>
<p class="p5"><span class="s1">document.addEventListener(</span><span class="s12">'DOMContentLoaded'</span><span class="s1">, () =&gt; {</span></p>
<p class="p8"><span class="s4"><span class="Apple-converted-space">    </span></span><span class="s1">// データを直接埋め込んだため、renderChapter() を呼び出すだけ</span></p>
<p class="p5"><span class="s1"><span class="Apple-converted-space">    </span>renderChapter();</span></p>
<p class="p5"><span class="s1">});</span></p>
<p class="p2"><span class="s3">&lt;/</span><span class="s1">script</span><span class="s3">&gt;</span></p>
<p class="p2"><span class="s3">&lt;/</span><span class="s1">body</span><span class="s3">&gt;</span></p>
<p class="p2"><span class="s3">&lt;/</span><span class="s1">html</span><span class="s3">&gt;</span></p>
<p class="p7"><span class="s10"></span><br></p>
<p class="p11"><span class="s10"></span><br></p>
</body>
</html>
